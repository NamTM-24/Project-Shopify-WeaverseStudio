const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index.js","./shopify.js","./iterable.js","./analytics-data.js","./cookies.js","./_commonjsHelpers.js","./validator.js","./device.js","./use-viewport-size.js","./vue.esm-bundler.js","./filtering.js","./campaigns.js","./use-dynamic-yield-api.js","./dynamic-yield-settings.js","./use-dynamic-yield-campaigns.js","./dynamic-yield-events.js","./observers.js"])))=>i.map(i=>d[i]);
import{i as z,S as Ne,e as be,w as Ke}from"./shopify.js";import"./iterable.js";import{i as qr,m as lr,a as ur,p as Kr,t as Gr,b as Vr,c as zr,g as At,T as Wr,d as $r,e as jr,f as Yr,h as Lt,Q as ae,r as Hr,j as Qr,s as Xr}from"./analytics-data.js";import{F as Ge}from"./filtering.js";import{r as bt,C as It,o as Zr,R as Jr,T as en}from"./campaigns.js";import{u as tn}from"./use-dynamic-yield-api.js";import{u as rn}from"./use-dynamic-yield-campaigns.js";import{t as nn}from"./dynamic-yield-events.js";import{i as on}from"./dynamic-yield-settings.js";import"./cookies.js";import"./_commonjsHelpers.js";import"./validator.js";import"./device.js";import"./use-viewport-size.js";import"./vue.esm-bundler.js";const sn=(t=window.location.search)=>t.includes(Ge.FILTER),an=(t=window.location.search)=>t.includes(Ge.SORT_BY),ln=()=>{if(!window.ALLBIRDS.Rudderstack.isIdentifyAndPageCalled&&window.ALLBIRDS.OneTrust.hasPerformanceConsent()){z("[Allbirds pixel] - RudderStack Page Load - sending analytics events");const t=lr();if(ur({additionalTraits:{fbclid:t.fbclid,gclid:t.gclid,msclkid:t.msclkid},forceIdentify:!0}),Kr(window.ALLBIRDS?.page?.template||"","",{client_platform:"liquid"}),window.ALLBIRDS?.page?.template==Ne.COLLECTION)Gr(),sn()&&Vr(),an()&&zr({collection:window.ALLBIRDS?.page?.collectionPage?.collection,featureLinkDestination:window.location.href,featureName:At(Ge.SORT_BY)?.toUpperCase(),featureType:Wr.SORTING.KEY});else if(window.ALLBIRDS?.page?.template==Ne.PRODUCT)$r();else if(window.ALLBIRDS?.page?.template==Ne.SEARCH){const e=At(Ge.QUERY)||"",r=document.querySelector("[data-search-results-count-text]");jr({searchEntry:Lt.SEARCH_PAGE,searchSource:window.location.href}),e&&Yr({query:e,searchEntry:Lt.SEARCH_PAGE,searchResultsCount:r.textContent,searchSource:window.location.href})}window.ALLBIRDS.Rudderstack.isIdentifyAndPageCalled=!0}},un=()=>{document.addEventListener("DOMContentLoaded",()=>{z("[Allbirds pixel] - RudderStack Page Load - page load event"),window.ALLBIRDS.Rudderstack.isIdentifyAndPageCalled=!1,qr(),bt(()=>{z("[Allbirds pixel] - RudderStack Page Load - rudderstack ready event",{isIdentifyAndPageCalled:window.ALLBIRDS.Rudderstack.isIdentifyAndPageCalled}),ln()},It.RUDDERSTACK_PAGE_LOAD)})},Dt=()=>window.location.search.includes(ae.EVENT_NAME_PARAM),cn=(t,e)=>{window.ALLBIRDS.OneTrust.hasPerformanceConsent()&&(z("[Allbirds pixel] - RudderStack Query String API - sending analytics event",{eventName:t,eventProps:e}),window.rudderanalytics.track(t,e))},dn=()=>{document.addEventListener("DOMContentLoaded",()=>{bt(()=>{if(z("[Allbirds pixel] - RudderStack Query String API - rudderstack ready event",{queryStringApi:Dt()}),Dt())try{const t={},r=new URL(window.location.href).searchParams,n=r.get(ae.EVENT_NAME_PARAM);for(const[o,s]of r.entries())if(o.startsWith(ae.EVENT_PROP_PREFIX_PARAM)){const a=o.substring(ae.EVENT_PROP_PREFIX_PARAM.length);let l=s;if(s.startsWith(ae.PROP_TYPE_OBJECT_PREFIX)){const u=s.replace(ae.PROP_TYPE_OBJECT_PREFIX,"");l=JSON.parse(u)}a&&(t[a]=l)}cn(n,t);const i=[ae.EVENT_NAME_PARAM,...Object.keys(t).map(o=>`${ae.EVENT_PROP_PREFIX_PARAM}${o}`)];Hr(i)}catch(t){be("[Allbirds pixel] - RudderStack Query String API - executeQueryStringApi - error parsing",{currentUrl:window.location.href},t)}},It.RUDDERSTACK_QUERY_STRING_API)})},we=window.ALLBIRDS.environment.types,Mt={[`${we.PRODUCTION}-UK`]:"1wsEvk2JSySDpu4GkRrODFa3wfu",[`${we.PRODUCTION}-US`]:"1wsEr0lioiZzgx5iZd40tVWiUJI",[`${we.STAGING}-UK`]:"1rPF2XhPLMKZS39MROI5nrujMIY",[`${we.STAGING}-US`]:"1rPF2XhPLMKZS39MROI5nrujMIY",[we.DEVELOPMENT]:"1xEmwnbSXytFtBkBAc7P0e79vg1"},{env:fn,shopId:vn}=window.ALLBIRDS.environment,hn=window.ALLBIRDS.environment.isUsStore,gn=Mt[`${fn}-${vn}`]||Mt[we.DEVELOPMENT],Rt=hn?"allbirds.com":"allbirds.co.uk",pn=`https://apisdk.${Rt}`,mn=`https://dataplane.${Rt}`,yn="oneTrust",kt=`https://jssdk.${Rt}/v3`;let Ot=!1;const Sn=(t,e,r)=>{let o=1;const s=setInterval(function(){window.rudderanalytics&&window.rudderanalytics.load?(window.rudderanalytics.load(t,e,r),clearInterval(s),z(`[Allbirds pixel] - Rudderstack SDK - calling sdk.load() function - after ${o} attempts`)):(o>60&&(clearInterval(s),be(`[Allbirds pixel] - Rudderstack SDK - could not be loaded - after ${o} attempts`,{},new Error("Rudderstack SDK could not be loaded"))),o++)},1e3)},En=()=>{const t=()=>{window.ALLBIRDS.Rudderstack.notifyConsentChange(window.ALLBIRDS.OneTrust.hasPerformanceConsent())};window.ALLBIRDS.Rudderstack&&window.ALLBIRDS.OneTrust?window.ALLBIRDS.OneTrust.isOneTrustActiveGroupsReady()?t():window.ALLBIRDS.OneTrust.onConsentChange(()=>{t()}):be("[Allbirds pixel] - Rudderstack SDK - could not notify consent change, OneTrust and Rudderstack SDKs are not loaded",{windowAllbirdsOneTrust:window.ALLBIRDS.OneTrust,windowAllbirdsRudderstack:window.ALLBIRDS.Rudderstack},new Error("OneTrust and Rudderstack SDKs are not loaded"))},wn=()=>{if(!Ot){const t={configUrl:pn,consentManagement:{enabled:!0,provider:yn},destSDKBaseURL:`${kt}/${window.rudderAnalyticsBuildType}/js-integrations`,integrations:{"Facebook Conversions":{hashed:!1}},loadIntegration:!1,logLevel:window.ALLBIRDS.settings.rudderstack.logLevel||"DEBUG",onLoaded:()=>{En(),z("[Allbirds pixel] - Rudderstack SDK - load event")},pluginsSDKBaseURL:`${kt}/${window.rudderAnalyticsBuildType}/plugins`,preConsent:{enabled:!0,events:{delivery:"buffer"},storage:{strategy:"session"}},storage:{encryption:{version:"legacy"}}};Sn(gn,mn,t),Ot=!0}};wn();un();dn();Zr();var at=function(t,e){return at=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},at(t,e)};function je(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");at(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var _=function(){return _=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},_.apply(this,arguments)};function P(t,e,r,n){function i(o){return o instanceof r?o:new r(function(s){s(o)})}return new(r||(r=Promise))(function(o,s){function a(c){try{u(n.next(c))}catch(f){s(f)}}function l(c){try{u(n.throw(c))}catch(f){s(f)}}function u(c){c.done?o(c.value):i(c.value).then(a,l)}u((n=n.apply(t,e||[])).next())})}function C(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(c){return l([u,c])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(r=0)),r;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){r.label=u[1];break}if(u[0]===6&&r.label<o[1]){r.label=o[1],o=u;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(u);break}o[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(c){u=[6,c],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function W(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function J(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o}function me(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}var xt;(function(t){t.SET="$set",t.SET_ONCE="$setOnce",t.ADD="$add",t.APPEND="$append",t.PREPEND="$prepend",t.REMOVE="$remove",t.PREINSERT="$preInsert",t.POSTINSERT="$postInsert",t.UNSET="$unset",t.CLEAR_ALL="$clearAll"})(xt||(xt={}));var lt;(function(t){t.IDENTIFY="$identify",t.GROUP_IDENTIFY="$groupidentify",t.REVENUE="revenue_amount"})(lt||(lt={}));var bn="AMP",In="".concat(bn,"_unsent"),cr="$default_instance",dr="https://api2.amplitude.com/2/httpapi",Rn="https://api.eu.amplitude.com/2/httpapi",Cn="https://api2.amplitude.com/batch",Pn="https://api.eu.amplitude.com/batch",U;(function(t){t.Unknown="unknown",t.Skipped="skipped",t.Success="success",t.RateLimit="rate_limit",t.PayloadTooLarge="payload_too_large",t.Invalid="invalid",t.Failed="failed",t.Timeout="Timeout",t.SystemError="SystemError"})(U||(U={}));var $=function(){var t="ampIntegrationContext";if(typeof globalThis<"u"&&typeof globalThis[t]<"u")return globalThis[t];if(typeof globalThis<"u")return globalThis;if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof global<"u")return global},Ut=function(t){return{promise:t||Promise.resolve()}},H;(function(t){t[t.None=0]="None",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Verbose=3]="Verbose",t[t.Debug=4]="Debug"})(H||(H={}));var Me="Amplitude Logger ",Ve=function(){function t(){this.logLevel=H.None}return t.prototype.disable=function(){this.logLevel=H.None},t.prototype.enable=function(e){e===void 0&&(e=H.Warn),this.logLevel=e},t.prototype.log=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this.logLevel<H.Verbose||console.log("".concat(Me,"[Log]: ").concat(e.join(" ")))},t.prototype.warn=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this.logLevel<H.Warn||console.warn("".concat(Me,"[Warn]: ").concat(e.join(" ")))},t.prototype.error=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this.logLevel<H.Error||console.error("".concat(Me,"[Error]: ").concat(e.join(" ")))},t.prototype.debug=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this.logLevel<H.Debug||console.log("".concat(Me,"[Debug]: ").concat(e.join(" ")))},t}(),Be=function(){return{flushMaxRetries:12,flushQueueSize:200,flushIntervalMillis:1e4,instanceName:cr,logLevel:H.Warn,loggerProvider:new Ve,offline:!1,optOut:!1,serverUrl:dr,serverZone:"US",useBatch:!1}},Tn=function(){function t(e){var r,n,i,o;this._optOut=!1;var s=Be();this.apiKey=e.apiKey,this.flushIntervalMillis=(r=e.flushIntervalMillis)!==null&&r!==void 0?r:s.flushIntervalMillis,this.flushMaxRetries=e.flushMaxRetries||s.flushMaxRetries,this.flushQueueSize=e.flushQueueSize||s.flushQueueSize,this.instanceName=e.instanceName||s.instanceName,this.loggerProvider=e.loggerProvider||s.loggerProvider,this.logLevel=(n=e.logLevel)!==null&&n!==void 0?n:s.logLevel,this.minIdLength=e.minIdLength,this.plan=e.plan,this.ingestionMetadata=e.ingestionMetadata,this.offline=e.offline!==void 0?e.offline:s.offline,this.optOut=(i=e.optOut)!==null&&i!==void 0?i:s.optOut,this.serverUrl=e.serverUrl,this.serverZone=e.serverZone||s.serverZone,this.storageProvider=e.storageProvider,this.transportProvider=e.transportProvider,this.useBatch=(o=e.useBatch)!==null&&o!==void 0?o:s.useBatch,this.loggerProvider.enable(this.logLevel);var a=An(e.serverUrl,e.serverZone,e.useBatch);this.serverZone=a.serverZone,this.serverUrl=a.serverUrl}return Object.defineProperty(t.prototype,"optOut",{get:function(){return this._optOut},set:function(e){this._optOut=e},enumerable:!1,configurable:!0}),t}(),_n=function(t,e){return t==="EU"?e?Pn:Rn:e?Cn:dr},An=function(t,e,r){if(t===void 0&&(t=""),e===void 0&&(e=Be().serverZone),r===void 0&&(r=Be().useBatch),t)return{serverUrl:t,serverZone:void 0};var n=["US","EU"].includes(e)?e:Be().serverZone;return{serverZone:n,serverUrl:_n(n,r)}},Ln=function(){function t(){}return t.prototype.getApplicationContext=function(){return{versionName:this.versionName,language:Dn(),platform:"Web",os:void 0,deviceModel:void 0}},t}(),Dn=function(){return typeof navigator<"u"&&(navigator.languages&&navigator.languages[0]||navigator.language)||""},Mn=function(){function t(){this.queue=[]}return t.prototype.logEvent=function(e){this.receiver?this.receiver(e):this.queue.length<512&&this.queue.push(e)},t.prototype.setEventReceiver=function(e){this.receiver=e,this.queue.length>0&&(this.queue.forEach(function(r){e(r)}),this.queue=[])},t}(),le=function(){return le=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},le.apply(this,arguments)};function Fe(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Nt(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o}var qe=function(t,e){var r,n,i=["string","number","boolean","undefined"],o=typeof t,s=typeof e;if(o!==s)return!1;try{for(var a=Fe(i),l=a.next();!l.done;l=a.next()){var u=l.value;if(u===o)return t===e}}catch(b){r={error:b}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;var c=Array.isArray(t),f=Array.isArray(e);if(c!==f)return!1;if(c&&f){for(var d=0;d<t.length;d++)if(!qe(t[d],e[d]))return!1}else{var v=Object.keys(t).sort(),m=Object.keys(e).sort();if(!qe(v,m))return!1;var h=!0;return Object.keys(t).forEach(function(b){qe(t[b],e[b])||(h=!1)}),h}return!0},kn="$set",On="$unset",xn="$clearAll";Object.entries||(Object.entries=function(t){for(var e=Object.keys(t),r=e.length,n=new Array(r);r--;)n[r]=[e[r],t[e[r]]];return n});var Un=function(){function t(){this.identity={userProperties:{}},this.listeners=new Set}return t.prototype.editIdentity=function(){var e=this,r=le({},this.identity.userProperties),n=le(le({},this.identity),{userProperties:r});return{setUserId:function(i){return n.userId=i,this},setDeviceId:function(i){return n.deviceId=i,this},setUserProperties:function(i){return n.userProperties=i,this},setOptOut:function(i){return n.optOut=i,this},updateUserProperties:function(i){var o,s,a,l,u,c,f=n.userProperties||{};try{for(var d=Fe(Object.entries(i)),v=d.next();!v.done;v=d.next()){var m=Nt(v.value,2),h=m[0],b=m[1];switch(h){case kn:try{for(var w=(a=void 0,Fe(Object.entries(b))),y=w.next();!y.done;y=w.next()){var E=Nt(y.value,2),I=E[0],R=E[1];f[I]=R}}catch(g){a={error:g}}finally{try{y&&!y.done&&(l=w.return)&&l.call(w)}finally{if(a)throw a.error}}break;case On:try{for(var S=(u=void 0,Fe(Object.keys(b))),p=S.next();!p.done;p=S.next()){var I=p.value;delete f[I]}}catch(g){u={error:g}}finally{try{p&&!p.done&&(c=S.return)&&c.call(S)}finally{if(u)throw u.error}}break;case xn:f={};break}}}catch(g){o={error:g}}finally{try{v&&!v.done&&(s=d.return)&&s.call(d)}finally{if(o)throw o.error}}return n.userProperties=f,this},commit:function(){return e.setIdentity(n),this}}},t.prototype.getIdentity=function(){return le({},this.identity)},t.prototype.setIdentity=function(e){var r=le({},this.identity);this.identity=le({},e),qe(r,this.identity)||this.listeners.forEach(function(n){n(e)})},t.prototype.addIdentityListener=function(e){this.listeners.add(e)},t.prototype.removeIdentityListener=function(e){this.listeners.delete(e)},t}(),Ie=typeof globalThis<"u"?globalThis:typeof global<"u"?global:self,Nn=function(){function t(){this.identityStore=new Un,this.eventBridge=new Mn,this.applicationContextProvider=new Ln}return t.getInstance=function(e){return Ie.analyticsConnectorInstances||(Ie.analyticsConnectorInstances={}),Ie.analyticsConnectorInstances[e]||(Ie.analyticsConnectorInstances[e]=new t),Ie.analyticsConnectorInstances[e]},t}(),Bn=function(t){return t===void 0&&(t=cr),Nn.getInstance(t)},Fn=function(t){var e=new Error().stack||"";return e.split(`
`).slice(2+t).map(function(r){return r.trim()})},he=function(t,e,r,n,i){return i===void 0&&(i=null),function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var a=r(),l=a.logger,u=a.logLevel;if(u&&u<H.Debug||!u||!l)return t.apply(i,o);var c={type:"invoke public method",name:e,args:o,stacktrace:Fn(1),time:{start:new Date().toISOString()},states:{}},f=t.apply(i,o);return f&&f.promise?f.promise.then(function(){c.time&&(c.time.end=new Date().toISOString()),l.debug(JSON.stringify(c,null,2))}):(c.time&&(c.time.end=new Date().toISOString()),l.debug(JSON.stringify(c,null,2))),f}},ut=function(t){var e=0;if(t.length===0)return e;for(var r=0;r<t.length;r++){var n=t.charCodeAt(r);e=(e<<5)-e+n,e|=0}return e},qn=function(t,e){var r=ut(t.toString()),n=Math.abs(r),i=n*31,o=i%1e6;return o/1e6<e},fr=function(){function t(){}return t.prototype.send=function(e,r){return Promise.resolve(null)},t.prototype.buildResponse=function(e){var r,n,i,o,s,a,l,u,c,f,d,v,m,h,b,w,y,E,I,R,S,p;if(typeof e!="object")return null;var g=e.code||0,T=this.buildStatus(g);switch(T){case U.Success:return{status:T,statusCode:g,body:{eventsIngested:(r=e.events_ingested)!==null&&r!==void 0?r:0,payloadSizeBytes:(n=e.payload_size_bytes)!==null&&n!==void 0?n:0,serverUploadTime:(i=e.server_upload_time)!==null&&i!==void 0?i:0}};case U.Invalid:return{status:T,statusCode:g,body:{error:(o=e.error)!==null&&o!==void 0?o:"",missingField:(s=e.missing_field)!==null&&s!==void 0?s:"",eventsWithInvalidFields:(a=e.events_with_invalid_fields)!==null&&a!==void 0?a:{},eventsWithMissingFields:(l=e.events_with_missing_fields)!==null&&l!==void 0?l:{},eventsWithInvalidIdLengths:(u=e.events_with_invalid_id_lengths)!==null&&u!==void 0?u:{},epsThreshold:(c=e.eps_threshold)!==null&&c!==void 0?c:0,exceededDailyQuotaDevices:(f=e.exceeded_daily_quota_devices)!==null&&f!==void 0?f:{},silencedDevices:(d=e.silenced_devices)!==null&&d!==void 0?d:[],silencedEvents:(v=e.silenced_events)!==null&&v!==void 0?v:[],throttledDevices:(m=e.throttled_devices)!==null&&m!==void 0?m:{},throttledEvents:(h=e.throttled_events)!==null&&h!==void 0?h:[]}};case U.PayloadTooLarge:return{status:T,statusCode:g,body:{error:(b=e.error)!==null&&b!==void 0?b:""}};case U.RateLimit:return{status:T,statusCode:g,body:{error:(w=e.error)!==null&&w!==void 0?w:"",epsThreshold:(y=e.eps_threshold)!==null&&y!==void 0?y:0,throttledDevices:(E=e.throttled_devices)!==null&&E!==void 0?E:{},throttledUsers:(I=e.throttled_users)!==null&&I!==void 0?I:{},exceededDailyQuotaDevices:(R=e.exceeded_daily_quota_devices)!==null&&R!==void 0?R:{},exceededDailyQuotaUsers:(S=e.exceeded_daily_quota_users)!==null&&S!==void 0?S:{},throttledEvents:(p=e.throttled_events)!==null&&p!==void 0?p:[]}};case U.Timeout:default:return{status:T,statusCode:g}}},t.prototype.buildStatus=function(e){return e>=200&&e<300?U.Success:e===429?U.RateLimit:e===413?U.PayloadTooLarge:e===408?U.Timeout:e>=400&&e<500?U.Invalid:e>=500?U.Failed:U.Unknown},t}(),Kn=function(t){je(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.send=function(r,n){return P(this,void 0,void 0,function(){var i,o,s;return C(this,function(a){switch(a.label){case 0:if(typeof fetch>"u")throw new Error("FetchTransport is not supported");return i={headers:{"Content-Type":"application/json",Accept:"*/*"},body:JSON.stringify(n),method:"POST"},[4,fetch(r,i)];case 1:return o=a.sent(),[4,o.text()];case 2:s=a.sent();try{return[2,this.buildResponse(JSON.parse(s))]}catch{return[2,this.buildResponse({code:o.status})]}return[2]}})})},e}(fr),Le;(function(t){t.US="US",t.EU="EU",t.STAGING="STAGING"})(Le||(Le={}));var vr="[Amplitude]",Gn="".concat(vr," Session Replay ID"),Vn=0,zn=Le.US,Wn={enabled:!0},hr=1e3,$n="".concat(vr," Session Replay Debug"),jn="amp-block",gr="amp-mask",Yn="amp-unmask",Hn="https://api-sr.amplitude.com/sessions/v2/track",Qn="https://api-sr.eu.amplitude.com/sessions/v2/track",Xn="https://api-sr.stag2.amplitude.com/sessions/v2/track",Zn=1*1e6,Jn=3e4,ei=6e4,ti=500,ri=10*1e3,pr=1024,ni=1e3,ue;(function(t){t.GET_SR_PROPS="get-sr-props",t.DEBUG_INFO="debug-info",t.FETCH_REQUEST="fetch-request",t.METADATA="metadata",t.TARGETING_DECISION="targeting-decision"})(ue||(ue={}));var ct=function(){function t(e){this.logger=e,this.log=this.getSafeMethod("log"),this.warn=this.getSafeMethod("warn"),this.error=this.getSafeMethod("error"),this.debug=this.getSafeMethod("debug")}return t.prototype.getSafeMethod=function(e){var r;if(!this.logger)return function(){};var n=this.logger[e];if(typeof n=="function"){var i=(r=n.__rrweb_original__)!==null&&r!==void 0?r:n;return i.bind(this.logger)}return function(){}},t.prototype.enable=function(e){this.logger.enable(e)},t.prototype.disable=function(){this.logger.disable()},t}(),dt="medium";function ii(t){return t.toLowerCase()}function oi(t){var e=t.type;return t.hasAttribute("data-rr-is-password")?"password":e?ii(e):null}var mr=function(t,e,r){switch(e){case"light":{if(t!=="input")return!0;var n=r?oi(r):"";return n?!!(["password","hidden","email","tel"].includes(n)||r.autocomplete.startsWith("cc-")):!1}case"medium":case"conservative":return!0;default:return mr(t,dt,r)}},si=function(t,e,r){var n,i,o;if(e===void 0&&(e={defaultMaskLevel:dt}),r){if(r.closest("."+gr))return!0;var s=((n=e.maskSelector)!==null&&n!==void 0?n:[]).some(function(l){return r.closest(l)});if(s)return!0;if(r.closest("."+Yn))return!1;var a=((i=e.unmaskSelector)!==null&&i!==void 0?i:[]).some(function(l){return r.closest(l)});if(a)return!1}return mr(t,(o=e.defaultMaskLevel)!==null&&o!==void 0?o:dt,r)},Bt=function(t,e){return function(r,n){return si(t,e,n)?r.replace(/[^\s]/g,"*"):r}},ai=function(){var t=$();return t?.location?t.location.href:""},li=function(t,e){return"".concat(e,"/").concat(t)},yr=function(t,e){return e||(t===Le.STAGING?Xn:t===Le.EU?Qn:Hn)},ui=function(t){if(typeof t!="string"||t.trim()==="")return!1;var e=/^\/|^https?:\/\/[^\s]+$/;return!!e.test(t)},ci=function(t){var e=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");return new RegExp("^".concat(e,"$"))},di=function(t){if(!t.every(function(e){return typeof e.selector=="string"&&typeof e.replacement=="string"}))throw new Error("ugcFilterRules must be an array of objects with selector and replacement properties");if(!t.every(function(e){return ui(e.selector)}))throw new Error("ugcFilterRules must be an array of objects with valid globs")},Ye=function(t,e){var r,n;try{for(var i=W(e),o=i.next();!o.done;o=i.next()){var s=o.value,a=ci(s.selector);if(a.test(t))return t.replace(a,s.replacement)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return t},Sr=function(){return P(void 0,void 0,void 0,function(){var t,e,r,n,i,o,s;return C(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),t=$(),t?[4,t.navigator.storage.estimate()]:[3,2];case 1:return e=a.sent(),r=e.usage,n=e.quota,i=e.usageDetails,o=r?Math.round(r/pr):0,s=r&&n?Math.round((r/n+Number.EPSILON)*1e3)/1e3:0,[2,{totalStorageSize:o,percentOfQuota:s,usageDetails:JSON.stringify(i)}];case 2:return[3,4];case 3:return a.sent(),[3,4];case 4:return[2,{totalStorageSize:0,percentOfQuota:0,usageDetails:""}]}})})},Er=function(t){var e=_({},t),r=e.apiKey;return e.apiKey="****".concat(r.substring(r.length-4)),e},wr=function(){return{flushMaxRetries:2,logLevel:H.Warn,loggerProvider:new Ve,transportProvider:new Kn}},fi=function(t){je(e,t);function e(r,n){var i=this,o,s,a,l,u,c=wr();return i=t.call(this,_(_({transportProvider:c.transportProvider,loggerProvider:new ct(n.loggerProvider||c.loggerProvider)},n),{apiKey:r}))||this,i.flushMaxRetries=n.flushMaxRetries!==void 0&&n.flushMaxRetries<=c.flushMaxRetries?n.flushMaxRetries:c.flushMaxRetries,i.apiKey=r,i.sampleRate=n.sampleRate||Vn,i.serverZone=n.serverZone||zn,i.configServerUrl=n.configServerUrl,i.trackServerUrl=n.trackServerUrl,i.shouldInlineStylesheet=n.shouldInlineStylesheet,i.version=n.version,i.performanceConfig=n.performanceConfig||Wn,i.storeType=(o=n.storeType)!==null&&o!==void 0?o:"idb",i.applyBackgroundColorToBlockedElements=(s=n.applyBackgroundColorToBlockedElements)!==null&&s!==void 0?s:!1,i.enableUrlChangePolling=(a=n.enableUrlChangePolling)!==null&&a!==void 0?a:!1,i.urlChangePollingInterval=(l=n.urlChangePollingInterval)!==null&&l!==void 0?l:hr,i.captureDocumentTitle=(u=n.captureDocumentTitle)!==null&&u!==void 0?u:!1,n.privacyConfig&&(i.privacyConfig=n.privacyConfig),n.interactionConfig&&(i.interactionConfig=n.interactionConfig,i.interactionConfig.ugcFilterRules&&di(i.interactionConfig.ugcFilterRules)),n.debugMode&&(i.debugMode=n.debugMode),n.experimental&&(i.experimental=n.experimental),n.omitElementTags&&(i.omitElementTags=n.omitElementTags),i}return e}(Tn);const vi="modulepreload",hi=function(t,e){return new URL(t,e).href},Ft={},Pe=function(e,r,n){let i=Promise.resolve();if(r&&r.length>0){let u=function(c){return Promise.all(c.map(f=>Promise.resolve(f).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};const s=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");i=u(r.map(c=>{if(c=hi(c,n),c in Ft)return;Ft[c]=!0;const f=c.endsWith(".css"),d=f?'[rel="stylesheet"]':"";if(n)for(let m=s.length-1;m>=0;m--){const h=s[m];if(h.href===c&&(!f||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${d}`))return;const v=document.createElement("link");if(v.rel=f?"stylesheet":vi,f||(v.as="script"),v.crossOrigin="",v.href=c,l&&v.setAttribute("nonce",l),document.head.appendChild(v),f)return new Promise((m,h)=>{v.addEventListener("load",m),v.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return i.then(s=>{for(const a of s||[])a.status==="rejected"&&o(a.reason);return e().catch(o)})};var br=(t=>(t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t))(br||{}),Ir=(t=>(t[t.MouseUp=0]="MouseUp",t[t.MouseDown=1]="MouseDown",t[t.Click=2]="Click",t[t.ContextMenu=3]="ContextMenu",t[t.DblClick=4]="DblClick",t[t.Focus=5]="Focus",t[t.Blur=6]="Blur",t[t.TouchStart=7]="TouchStart",t[t.TouchMove_Departed=8]="TouchMove_Departed",t[t.TouchEnd=9]="TouchEnd",t[t.TouchCancel=10]="TouchCancel",t))(Ir||{}),ze;(function(t){t.US="US",t.EU="EU",t.STAGING="STAGING"})(ze||(ze={}));var N;(function(t){t.Unknown="unknown",t.Skipped="skipped",t.Success="success",t.RateLimit="rate_limit",t.PayloadTooLarge="payload_too_large",t.Invalid="invalid",t.Failed="failed",t.Timeout="Timeout",t.SystemError="SystemError"})(N||(N={}));var gi=function(){function t(){}return t.prototype.send=function(e,r){return Promise.resolve(null)},t.prototype.buildResponse=function(e){var r,n,i,o,s,a,l,u,c,f,d,v,m,h,b,w,y,E,I,R,S,p;if(typeof e!="object")return null;var g=e.code||0,T=this.buildStatus(g);switch(T){case N.Success:return{status:T,statusCode:g,body:{eventsIngested:(r=e.events_ingested)!==null&&r!==void 0?r:0,payloadSizeBytes:(n=e.payload_size_bytes)!==null&&n!==void 0?n:0,serverUploadTime:(i=e.server_upload_time)!==null&&i!==void 0?i:0}};case N.Invalid:return{status:T,statusCode:g,body:{error:(o=e.error)!==null&&o!==void 0?o:"",missingField:(s=e.missing_field)!==null&&s!==void 0?s:"",eventsWithInvalidFields:(a=e.events_with_invalid_fields)!==null&&a!==void 0?a:{},eventsWithMissingFields:(l=e.events_with_missing_fields)!==null&&l!==void 0?l:{},eventsWithInvalidIdLengths:(u=e.events_with_invalid_id_lengths)!==null&&u!==void 0?u:{},epsThreshold:(c=e.eps_threshold)!==null&&c!==void 0?c:0,exceededDailyQuotaDevices:(f=e.exceeded_daily_quota_devices)!==null&&f!==void 0?f:{},silencedDevices:(d=e.silenced_devices)!==null&&d!==void 0?d:[],silencedEvents:(v=e.silenced_events)!==null&&v!==void 0?v:[],throttledDevices:(m=e.throttled_devices)!==null&&m!==void 0?m:{},throttledEvents:(h=e.throttled_events)!==null&&h!==void 0?h:[]}};case N.PayloadTooLarge:return{status:T,statusCode:g,body:{error:(b=e.error)!==null&&b!==void 0?b:""}};case N.RateLimit:return{status:T,statusCode:g,body:{error:(w=e.error)!==null&&w!==void 0?w:"",epsThreshold:(y=e.eps_threshold)!==null&&y!==void 0?y:0,throttledDevices:(E=e.throttled_devices)!==null&&E!==void 0?E:{},throttledUsers:(I=e.throttled_users)!==null&&I!==void 0?I:{},exceededDailyQuotaDevices:(R=e.exceeded_daily_quota_devices)!==null&&R!==void 0?R:{},exceededDailyQuotaUsers:(S=e.exceeded_daily_quota_users)!==null&&S!==void 0?S:{},throttledEvents:(p=e.throttled_events)!==null&&p!==void 0?p:[]}};case N.Timeout:default:return{status:T,statusCode:g}}},t.prototype.buildStatus=function(e){return e>=200&&e<300?N.Success:e===429?N.RateLimit:e===413?N.PayloadTooLarge:e===408?N.Timeout:e>=400&&e<500?N.Invalid:e>=500?N.Failed:N.Unknown},t}(),pi="Network error occurred, remote config fetch failed",mi="Remote config successfully fetched",yi="Remote config fetch rejected due to exceeded retry count",qt="Remote config fetch rejected due to timeout after 5 seconds",Kt="Unexpected error occurred",Si="https://sr-client-cfg.amplitude.com/config",Ei="https://sr-client-cfg.stag2.amplitude.com/config",wi="https://sr-client-cfg.eu.amplitude.com/config",bi=function(){function t(e){var r=e.localConfig,n=e.configKeys,i=this;this.retryTimeout=1e3,this.attempts=0,this.sessionTargetingMatch=!1,this.metrics={},this.getRemoteNamespaceConfig=function(o,s){return P(i,void 0,void 0,function(){var a,l,u;return C(this,function(c){switch(c.label){case 0:return a=Date.now(),[4,this.fetchWithTimeout(s)];case 1:return l=c.sent(),l&&(u=l.configs&&l.configs[o],u)?(this.metrics.fetchTimeAPISuccess=Date.now()-a,[2,u]):(this.metrics.fetchTimeAPIFail=Date.now()-a,[2,void 0])}})})},this.getRemoteConfig=function(o,s,a){return P(i,void 0,void 0,function(){var l;return C(this,function(u){switch(u.label){case 0:return[4,this.getRemoteNamespaceConfig(o,a)];case 1:return l=u.sent(),[2,l?.[s]]}})})},this.fetchWithTimeout=function(o){return P(i,void 0,void 0,function(){var s,a,l;return C(this,function(u){switch(u.label){case 0:return s=new AbortController,a=setTimeout(function(){return s.abort()},5e3),[4,this.fetchRemoteConfig(s.signal,o)];case 1:return l=u.sent(),clearTimeout(a),[2,l]}})})},this.fetchRemoteConfig=function(o,s){return P(i,void 0,void 0,function(){var a,l,u,c,f,d,v,m,h,b,w,y,E;return C(this,function(I){switch(I.label){case 0:if(s===this.lastFetchedSessionId&&this.attempts>=this.localConfig.flushMaxRetries)return[2,this.completeRequest({err:yi})];if(o.aborted)return[2,this.completeRequest({err:qt})];s!==this.lastFetchedSessionId&&(this.lastFetchedSessionId=s,this.attempts=0),I.label=1;case 1:I.trys.push([1,3,,4]),a=new URLSearchParams({api_key:this.localConfig.apiKey});try{for(l=W(this.configKeys),u=l.next();!u.done;u=l.next())c=u.value,a.append("config_keys",c)}catch(R){w={error:R}}finally{try{u&&!u.done&&(y=l.return)&&y.call(l)}finally{if(w)throw w.error}}return s&&a.set("session_id",String(s)),f={headers:{Accept:"*/*"},method:"GET"},d="".concat(this.getServerUrl(),"?").concat(a.toString()),this.attempts+=1,[4,fetch(d,_(_({},f),{signal:o}))];case 2:if(v=I.sent(),v===null)return[2,this.completeRequest({err:Kt})];switch(m=new gi().buildStatus(v.status),m){case N.Success:return this.attempts=0,[2,this.parseAndStoreConfig(v)];case N.Failed:return[2,this.retryFetch(o,s)];default:return[2,this.completeRequest({err:pi})]}case 3:return h=I.sent(),b=h,o.aborted?[2,this.completeRequest({err:qt})]:[2,this.completeRequest({err:(E=b.message)!==null&&E!==void 0?E:Kt})];case 4:return[2]}})})},this.retryFetch=function(o,s){return P(i,void 0,void 0,function(){var a=this;return C(this,function(l){switch(l.label){case 0:return[4,new Promise(function(u){return setTimeout(u,a.attempts*a.retryTimeout)})];case 1:return l.sent(),[2,this.fetchRemoteConfig(o,s)]}})})},this.parseAndStoreConfig=function(o){return P(i,void 0,void 0,function(){var s;return C(this,function(a){switch(a.label){case 0:return[4,o.json()];case 1:return s=a.sent(),this.completeRequest({success:mi}),[2,s]}})})},this.localConfig=r,this.configKeys=n}return t.prototype.getServerUrl=function(){return this.localConfig.configServerUrl?this.localConfig.configServerUrl:this.localConfig.serverZone===ze.STAGING?Ei:this.localConfig.serverZone===ze.EU?wi:Si},t.prototype.completeRequest=function(e){var r=e.err,n=e.success;if(r)throw new Error(r);n&&this.localConfig.loggerProvider.log(n)},t}(),Ii=function(t){var e=t.localConfig,r=t.configKeys;return P(void 0,void 0,void 0,function(){return C(this,function(n){return[2,new bi({localConfig:e,configKeys:r})]})})},Ri=Ii,Ci=function(t,e){var r=document.createDocumentFragment(),n=function(i){if(i===void 0&&(i=[]),typeof i=="string"&&(i=[i]),i=i.filter(function(o){try{r.querySelector(o)}catch{return e.warn('[session-replay-browser] omitting selector "'.concat(o,'" because it is invalid')),!1}return!0}),i.length!==0)return i};return t.blockSelector=n(t.blockSelector),t.maskSelector=n(t.maskSelector),t.unmaskSelector=n(t.unmaskSelector),t},Pi=function(){function t(e,r){this.localConfig=r,this.remoteConfigFetch=e}return t.prototype.generateJoinedConfig=function(e){var r,n,i,o;return P(this,void 0,void 0,function(){var s,a,l,u,c,f,d,v,m,h,b,w,y,E,I,R,S,p,g,T,L,A,x;return C(this,function(j){switch(j.label){case 0:s=_({},this.localConfig),s.optOut=this.localConfig.optOut,s.captureEnabled=!0,j.label=1;case 1:return j.trys.push([1,3,,4]),[4,this.remoteConfigFetch.getRemoteNamespaceConfig("sessionReplay",e)];case 2:return l=j.sent(),l&&(u=l.sr_sampling_config,c=l.sr_privacy_config,f=l.sr_targeting_config,d=(r=s.interactionConfig)===null||r===void 0?void 0:r.ugcFilterRules,s.interactionConfig=l.sr_interaction_config,s.interactionConfig&&d&&(s.interactionConfig.ugcFilterRules=d),s.loggingConfig=l.sr_logging_config,(u||c||f)&&(a={},u&&(a.sr_sampling_config=u),c&&(a.sr_privacy_config=c),f&&(a.sr_targeting_config=f))),[3,4];case 3:return v=j.sent(),m=v,this.localConfig.loggerProvider.warn(m.message),s.captureEnabled=!1,[3,4];case 4:if(!a)return[2,{localConfig:this.localConfig,joinedConfig:s,remoteConfig:a}];if(h=a.sr_sampling_config,b=a.sr_privacy_config,w=a.sr_targeting_config,h&&Object.keys(h).length>0?(Object.prototype.hasOwnProperty.call(h,"capture_enabled")?s.captureEnabled=h.capture_enabled:s.captureEnabled=!1,Object.prototype.hasOwnProperty.call(h,"sample_rate")&&(s.sampleRate=h.sample_rate)):(s.captureEnabled=!0,this.localConfig.loggerProvider.debug("Remote config successfully fetched, but no values set for project, Session Replay capture enabled.")),b){y=(n=s.privacyConfig)!==null&&n!==void 0?n:{},E={defaultMaskLevel:(o=(i=b.defaultMaskLevel)!==null&&i!==void 0?i:y.defaultMaskLevel)!==null&&o!==void 0?o:"medium",blockSelector:[],maskSelector:[],unmaskSelector:[]},I=function(k){var B,V,M,K,Y,Se,G,ee,Z,F={};typeof k.blockSelector=="string"&&(k.blockSelector=[k.blockSelector]);try{for(var O=W((G=k.blockSelector)!==null&&G!==void 0?G:[]),de=O.next();!de.done;de=O.next()){var re=de.value;F[re]="block"}}catch(oe){B={error:oe}}finally{try{de&&!de.done&&(V=O.return)&&V.call(O)}finally{if(B)throw B.error}}try{for(var ne=W((ee=k.maskSelector)!==null&&ee!==void 0?ee:[]),fe=ne.next();!fe.done;fe=ne.next()){var re=fe.value;F[re]="mask"}}catch(oe){M={error:oe}}finally{try{fe&&!fe.done&&(K=ne.return)&&K.call(ne)}finally{if(M)throw M.error}}try{for(var ve=W((Z=k.unmaskSelector)!==null&&Z!==void 0?Z:[]),ie=ve.next();!ie.done;ie=ve.next()){var re=ie.value;F[re]="unmask"}}catch(oe){Y={error:oe}}finally{try{ie&&!ie.done&&(Se=ve.return)&&Se.call(ve)}finally{if(Y)throw Y.error}}return F},R=_(_({},I(y)),I(b));try{for(S=W(Object.entries(R)),p=S.next();!p.done;p=S.next())g=J(p.value,2),T=g[0],L=g[1],L==="mask"?E.maskSelector.push(T):L==="block"?E.blockSelector.push(T):L==="unmask"&&E.unmaskSelector.push(T)}catch(k){A={error:k}}finally{try{p&&!p.done&&(x=S.return)&&x.call(S)}finally{if(A)throw A.error}}s.privacyConfig=Ci(E,this.localConfig.loggerProvider)}return w&&Object.keys(w).length>0&&(s.targetingConfig=w),this.localConfig.loggerProvider.debug(JSON.stringify({name:"session replay joined config",config:Er(s)},null,2)),[2,{localConfig:this.localConfig,joinedConfig:s,remoteConfig:a}]}})})},t}(),Ti=function(t,e){return P(void 0,void 0,void 0,function(){var r,n;return C(this,function(i){switch(i.label){case 0:return r=new fi(t,e),[4,Ri({localConfig:r,configKeys:["sessionReplay"]})];case 1:return n=i.sent(),[2,new Pi(n,r)]}})})},Q=Uint8Array,q=Uint16Array,De=Uint32Array,Ct=new Q([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Pt=new Q([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Gt=new Q([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Rr=function(t,e){for(var r=new q(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var i=new De(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)i[o]=o-r[n]<<5|n;return[r,i]},Cr=Rr(Ct,2),_i=Cr[0],ft=Cr[1];_i[28]=258,ft[258]=28;var Ai=Rr(Pt,0),Vt=Ai[1],vt=new q(32768);for(var D=0;D<32768;++D){var se=(D&43690)>>>1|(D&21845)<<1;se=(se&52428)>>>2|(se&13107)<<2,se=(se&61680)>>>4|(se&3855)<<4,vt[D]=((se&65280)>>>8|(se&255)<<8)>>>1}var Te=function(t,e,r){for(var n=t.length,i=0,o=new q(e);i<n;++i)++o[t[i]-1];var s=new q(e);for(i=0;i<e;++i)s[i]=s[i-1]+o[i-1]<<1;var a;if(r){a=new q(1<<e);var l=15-e;for(i=0;i<n;++i)if(t[i])for(var u=i<<4|t[i],c=e-t[i],f=s[t[i]-1]++<<c,d=f|(1<<c)-1;f<=d;++f)a[vt[f]>>>l]=u}else for(a=new q(n),i=0;i<n;++i)a[i]=vt[s[t[i]-1]++]>>>15-t[i];return a},ye=new Q(288);for(var D=0;D<144;++D)ye[D]=8;for(var D=144;D<256;++D)ye[D]=9;for(var D=256;D<280;++D)ye[D]=7;for(var D=280;D<288;++D)ye[D]=8;var We=new Q(32);for(var D=0;D<32;++D)We[D]=5;var Li=Te(ye,9,0),Di=Te(We,5,0),Pr=function(t){return(t/8>>0)+(t&7&&1)},Tr=function(t,e,r){(r==null||r>t.length)&&(r=t.length);var n=new(t instanceof q?q:t instanceof De?De:Q)(r-e);return n.set(t.subarray(e,r)),n},te=function(t,e,r){r<<=e&7;var n=e/8>>0;t[n]|=r,t[n+1]|=r>>>8},Re=function(t,e,r){r<<=e&7;var n=e/8>>0;t[n]|=r,t[n+1]|=r>>>8,t[n+2]|=r>>>16},Ze=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var i=r.length,o=r.slice();if(!i)return[new Q(0),0];if(i==1){var s=new Q(r[0].s+1);return s[r[0].s]=1,[s,1]}r.sort(function(R,S){return R.f-S.f}),r.push({s:-1,f:25001});var a=r[0],l=r[1],u=0,c=1,f=2;for(r[0]={s:-1,f:a.f+l.f,l:a,r:l};c!=i-1;)a=r[r[u].f<r[f].f?u++:f++],l=r[u!=c&&r[u].f<r[f].f?u++:f++],r[c++]={s:-1,f:a.f+l.f,l:a,r:l};for(var d=o[0].s,n=1;n<i;++n)o[n].s>d&&(d=o[n].s);var v=new q(d+1),m=ht(r[c-1],v,0);if(m>e){var n=0,h=0,b=m-e,w=1<<b;for(o.sort(function(S,p){return v[p.s]-v[S.s]||S.f-p.f});n<i;++n){var y=o[n].s;if(v[y]>e)h+=w-(1<<m-v[y]),v[y]=e;else break}for(h>>>=b;h>0;){var E=o[n].s;v[E]<e?h-=1<<e-v[E]++-1:++n}for(;n>=0&&h;--n){var I=o[n].s;v[I]==e&&(--v[I],++h)}m=e}return[new Q(v),m]},ht=function(t,e,r){return t.s==-1?Math.max(ht(t.l,e,r+1),ht(t.r,e,r+1)):e[t.s]=r},zt=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new q(++e),n=0,i=t[0],o=1,s=function(l){r[n++]=l},a=1;a<=e;++a)if(t[a]==i&&a!=e)++o;else{if(!i&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(i),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(i);o=1,i=t[a]}return[r.subarray(0,n),e]},Ce=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},gt=function(t,e,r){var n=r.length,i=Pr(e+2);t[i]=n&255,t[i+1]=n>>>8,t[i+2]=t[i]^255,t[i+3]=t[i+1]^255;for(var o=0;o<n;++o)t[i+o+4]=r[o];return(i+4+n)*8},Wt=function(t,e,r,n,i,o,s,a,l,u,c){te(e,c++,r),++i[256];for(var f=Ze(i,15),d=f[0],v=f[1],m=Ze(o,15),h=m[0],b=m[1],w=zt(d),y=w[0],E=w[1],I=zt(h),R=I[0],S=I[1],p=new q(19),g=0;g<y.length;++g)p[y[g]&31]++;for(var g=0;g<R.length;++g)p[R[g]&31]++;for(var T=Ze(p,7),L=T[0],A=T[1],x=19;x>4&&!L[Gt[x-1]];--x);var j=u+5<<3,k=Ce(i,ye)+Ce(o,We)+s,B=Ce(i,d)+Ce(o,h)+s+14+3*x+Ce(p,L)+(2*p[16]+3*p[17]+7*p[18]);if(j<=k&&j<=B)return gt(e,c,t.subarray(l,l+u));var V,M,K,Y;if(te(e,c,1+(B<k)),c+=2,B<k){V=Te(d,v,0),M=d,K=Te(h,b,0),Y=h;var Se=Te(L,A,0);te(e,c,E-257),te(e,c+5,S-1),te(e,c+10,x-4),c+=14;for(var g=0;g<x;++g)te(e,c+3*g,L[Gt[g]]);c+=3*x;for(var G=[y,R],ee=0;ee<2;++ee)for(var Z=G[ee],g=0;g<Z.length;++g){var F=Z[g]&31;te(e,c,Se[F]),c+=L[F],F>15&&(te(e,c,Z[g]>>>5&127),c+=Z[g]>>>12)}}else V=Li,M=ye,K=Di,Y=We;for(var g=0;g<a;++g)if(n[g]>255){var F=n[g]>>>18&31;Re(e,c,V[F+257]),c+=M[F+257],F>7&&(te(e,c,n[g]>>>23&31),c+=Ct[F]);var O=n[g]&31;Re(e,c,K[O]),c+=Y[O],O>3&&(Re(e,c,n[g]>>>5&8191),c+=Pt[O])}else Re(e,c,V[n[g]]),c+=M[n[g]];return Re(e,c,V[256]),c+M[256]},Mi=new De([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ki=function(t,e,r,n,i,o){var s=t.length,a=new Q(n+s+5*(1+Math.floor(s/7e3))+i),l=a.subarray(n,a.length-i),u=0;if(!e||s<8)for(var c=0;c<=s;c+=65535){var f=c+65535;f<s?u=gt(l,u,t.subarray(c,f)):(l[c]=o,u=gt(l,u,t.subarray(c,s)))}else{for(var d=Mi[e-1],v=d>>>13,m=d&8191,h=(1<<r)-1,b=new q(32768),w=new q(h+1),y=Math.ceil(r/3),E=2*y,I=function(Xe){return(t[Xe]^t[Xe+1]<<y^t[Xe+2]<<E)&h},R=new De(25e3),S=new q(288),p=new q(32),g=0,T=0,c=0,L=0,A=0,x=0;c<s;++c){var j=I(c),k=c&32767,B=w[j];if(b[k]=B,w[j]=k,A<=c){var V=s-c;if((g>7e3||L>24576)&&V>423){u=Wt(t,l,0,R,S,p,T,L,x,c-x,u),L=g=T=0,x=c;for(var M=0;M<286;++M)S[M]=0;for(var M=0;M<30;++M)p[M]=0}var K=2,Y=0,Se=m,G=k-B&32767;if(V>2&&j==I(c-G))for(var ee=Math.min(v,V)-1,Z=Math.min(32767,c),F=Math.min(258,V);G<=Z&&--Se&&k!=B;){if(t[c+K]==t[c+K-G]){for(var O=0;O<F&&t[c+O]==t[c+O-G];++O);if(O>K){if(K=O,Y=G,O>ee)break;for(var de=Math.min(G,O-2),re=0,M=0;M<de;++M){var ne=c-G+M+32768&32767,fe=b[ne],ve=ne-fe+32768&32767;ve>re&&(re=ve,B=ne)}}}k=B,B=b[k],G+=k-B+32768&32767}if(Y){R[L++]=268435456|ft[K]<<18|Vt[Y];var ie=ft[K]&31,oe=Vt[Y]&31;T+=Ct[ie]+Pt[oe],++S[257+ie],++p[oe],A=c+K,++g}else R[L++]=t[c],++S[t[c]]}}u=Wt(t,l,o,R,S,p,T,L,x,c-x,u)}return Tr(a,0,n+Pr(u)+i)},Oi=function(){var t=1,e=0;return{p:function(r){for(var n=t,i=e,o=r.length,s=0;s!=o;){for(var a=Math.min(s+5552,o);s<a;++s)n+=r[s],i+=n;n%=65521,i%=65521}t=n,e=i},d:function(){return(t>>>8<<16|(e&255)<<8|e>>>8)+((t&255)<<23)*2}}},xi=function(t,e,r,n,i){return ki(t,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):12+e.mem,r,n,!0)},Ui=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8},Ni=function(t,e){var r=e.level,n=r==0?0:r<6?1:r==9?3:2;t[0]=120,t[1]=n<<6|(n?32-2*n:1)};function Bi(t,e){e===void 0&&(e={});var r=Oi();r.p(t);var n=xi(t,e,2,4);return Ni(n,e),Ui(n,n.length-4,r.d()),n}function Fi(t,e){var r=t.length;if(typeof TextEncoder<"u")return new TextEncoder().encode(t);for(var n=new Q(t.length+(t.length>>>1)),i=0,o=function(u){n[i++]=u},s=0;s<r;++s){if(i+5>n.length){var a=new Q(i+8+(r-s<<1));a.set(n),n=a}var l=t.charCodeAt(s);l<128||e?o(l):l<2048?(o(192|l>>>6),o(128|l&63)):l>55295&&l<57344?(l=65536+(l&1047552)|t.charCodeAt(++s)&1023,o(240|l>>>18),o(128|l>>>12&63),o(128|l>>>6&63),o(128|l&63)):(o(224|l>>>12),o(128|l>>>6&63),o(128|l&63))}return Tr(n,0,i)}function qi(t,e){for(var r="",n=0;n<t.length;){var i=t[n++];r+=String.fromCharCode(i)}return r}const Ki="v1",Gi=t=>{const e={...t,v:Ki};return qi(Bi(Fi(JSON.stringify(e))))};var Vi=2e3,zi=function(){function t(e,r,n,i){var o=this,s;this.taskQueue=[],this.isProcessing=!1,this.compressEvent=function(u){var c=Gi(u);return JSON.stringify(c)},this.addCompressedEventToManager=function(u,c){o.eventsManager&&o.deviceId&&o.eventsManager.addEvent({event:{type:"replay",data:u},sessionId:c,deviceId:o.deviceId})},this.addCompressedEvent=function(u,c){if(o.worker)try{o.worker.postMessage({event:u,sessionId:c})}catch(d){d.name==="DataCloneError"?o.worker.postMessage(JSON.stringify({event:u,sessionId:c})):o.config.loggerProvider.warn("Unexpected error while posting message to worker:",d)}else{var f=o.compressEvent(u);o.addCompressedEventToManager(f,c)}},this.terminate=function(){var u;(u=o.worker)===null||u===void 0||u.terminate()};var a=$();if(this.canUseIdleCallback=a&&"requestIdleCallback"in a,this.eventsManager=e,this.config=r,this.deviceId=n,this.timeout=((s=r.performanceConfig)===null||s===void 0?void 0:s.timeout)||Vi,i){r.loggerProvider.log("[Experimental] Enabling web worker for compression");var l=new Worker(URL.createObjectURL(new Blob([i],{type:"application/javascript"})));l.onerror=function(u){r.loggerProvider.error(u)},l.onmessage=function(u){var c=u.data,f=c.compressedEvent,d=c.sessionId;o.addCompressedEventToManager(f,d)},this.worker=l}}return t.prototype.scheduleIdleProcessing=function(){var e=this;this.isProcessing||(this.isProcessing=!0,requestIdleCallback(function(r){e.processQueue(r)},{timeout:this.timeout}))},t.prototype.enqueueEvent=function(e,r){var n;this.canUseIdleCallback&&(!((n=this.config.performanceConfig)===null||n===void 0)&&n.enabled)?(this.config.loggerProvider.debug("Enqueuing event for processing during idle time."),this.taskQueue.push({event:e,sessionId:r}),this.scheduleIdleProcessing()):(this.config.loggerProvider.debug("Processing event without idle callback."),this.addCompressedEvent(e,r))},t.prototype.processQueue=function(e){for(var r=this;this.taskQueue.length>0&&(e.timeRemaining()>0||e.didTimeout);){var n=this.taskQueue.shift();if(n){var i=n.event,o=n.sessionId;this.addCompressedEvent(i,o)}}this.taskQueue.length>0?requestIdleCallback(function(s){r.processQueue(s)},{timeout:this.timeout}):this.isProcessing=!1},t}(),Wi="Unexpected error occurred",$i="Network error occurred, event batch rejected",ji="Session replay event batch rejected due to exceeded retry count",Ee="Failed to store session replay events in IndexedDB",Yi="Session replay event batch not sent due to missing device ID",Hi="Session replay event batch not sent due to missing api key",pt="1.28.18",Qi=function(){function t(e){var r=e.trackServerUrl,n=e.loggerProvider,i=e.payloadBatcher;this.storageKey="",this.retryTimeout=1e3,this.scheduled=null,this.queue=[],this.loggerProvider=n,this.payloadBatcher=i||function(o){return o},this.trackServerUrl=r}return t.prototype.sendEventsList=function(e){this.addToQueue(_(_({},e),{attempts:0,timeout:0}))},t.prototype.addToQueue=function(){for(var e=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r.filter(function(o){return o.attempts<(o.flushMaxRetries||0)?(o.attempts+=1,!0):(e.completeRequest({context:o,err:ji}),!1)});i.forEach(function(o){if(e.queue=e.queue.concat(o),o.timeout===0){e.schedule(0);return}setTimeout(function(){o.timeout=0,e.schedule(0)},o.timeout)})},t.prototype.schedule=function(e){var r=this;this.scheduled||(this.scheduled=setTimeout(function(){r.flush(!0).then(function(){r.queue.length>0&&r.schedule(e)})},e))},t.prototype.flush=function(e){return e===void 0&&(e=!1),P(this,void 0,void 0,function(){var r,n,i=this;return C(this,function(o){switch(o.label){case 0:return r=[],n=[],this.queue.forEach(function(s){return s.timeout===0?r.push(s):n.push(s)}),this.queue=n,this.scheduled&&(clearTimeout(this.scheduled),this.scheduled=null),[4,Promise.all(r.map(function(s){return i.send(s,e)}))];case 1:return o.sent(),[2]}})})},t.prototype.send=function(e,r){var n,i;return r===void 0&&(r=!0),P(this,void 0,void 0,function(){var o,s,a,l,u,c,f,d,v,m,h,b,w;return C(this,function(y){switch(y.label){case 0:if(o=e.apiKey,!o)return[2,this.completeRequest({context:e,err:Hi})];if(s=e.deviceId,!s)return[2,this.completeRequest({context:e,err:Yi})];if(a=ai(),l=pt,u=e.sampleRate,c=new URLSearchParams({device_id:s,session_id:"".concat(e.sessionId),type:"".concat(e.type)}),f="".concat(((n=e.version)===null||n===void 0?void 0:n.type)||"standalone","/").concat(((i=e.version)===null||i===void 0?void 0:i.version)||l),d=this.payloadBatcher({version:1,events:e.events}),d.events.length===0)return this.completeRequest({context:e}),[2];y.label=1;case 1:return y.trys.push([1,3,,4]),v={headers:{"Content-Type":"application/json",Accept:"*/*",Authorization:"Bearer ".concat(o),"X-Client-Version":l,"X-Client-Library":f,"X-Client-Url":a.substring(0,ni),"X-Client-Sample-Rate":"".concat(u)},body:JSON.stringify(d),method:"POST"},m="".concat(yr(e.serverZone,this.trackServerUrl),"?").concat(c.toString()),[4,fetch(m,v)];case 2:if(h=y.sent(),h===null)return this.completeRequest({context:e,err:Wi}),[2];if(r)this.handleReponse(h.status,e);else{b="";try{b=JSON.stringify(h.body,null,2)}catch{}this.completeRequest({context:e,success:"".concat(h.status,": ").concat(b)})}return[3,4];case 3:return w=y.sent(),this.completeRequest({context:e,err:w}),[3,4];case 4:return[2]}})})},t.prototype.handleReponse=function(e,r){var n=new fr().buildStatus(e);switch(n){case U.Success:this.handleSuccessResponse(r);break;case U.Failed:this.handleOtherResponse(r);break;default:this.completeRequest({context:r,err:$i})}},t.prototype.handleSuccessResponse=function(e){var r=Math.round(new Blob(e.events).size/pr);this.completeRequest({context:e,success:"Session replay event batch tracked successfully for session id ".concat(e.sessionId,", size of events: ").concat(r," KB")})},t.prototype.handleOtherResponse=function(e){this.addToQueue(_(_({},e),{timeout:e.attempts*this.retryTimeout}))},t.prototype.completeRequest=function(e){var r=e.context,n=e.err,i=e.success;r.onComplete(),n?this.loggerProvider.warn(n):i&&this.loggerProvider.log(i)},t}();const mt=(t,e)=>e.some(r=>t instanceof r);let $t,jt;function Xi(){return $t||($t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Zi(){return jt||(jt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const yt=new WeakMap,Je=new WeakMap,He=new WeakMap;function Ji(t){const e=new Promise((r,n)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",s)},o=()=>{r(pe(t.result)),i()},s=()=>{n(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",s)});return He.set(e,t),e}function eo(t){if(yt.has(t))return;const e=new Promise((r,n)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",s),t.removeEventListener("abort",s)},o=()=>{r(),i()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",s),t.addEventListener("abort",s)});yt.set(t,e)}let St={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return yt.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return pe(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function _r(t){St=t(St)}function to(t){return Zi().includes(t)?function(...e){return t.apply(Et(this),e),pe(this.request)}:function(...e){return pe(t.apply(Et(this),e))}}function ro(t){return typeof t=="function"?to(t):(t instanceof IDBTransaction&&eo(t),mt(t,Xi())?new Proxy(t,St):t)}function pe(t){if(t instanceof IDBRequest)return Ji(t);if(Je.has(t))return Je.get(t);const e=ro(t);return e!==t&&(Je.set(t,e),He.set(e,t)),e}const Et=t=>He.get(t);function Ar(t,e,{blocked:r,upgrade:n,blocking:i,terminated:o}={}){const s=indexedDB.open(t,e),a=pe(s);return n&&s.addEventListener("upgradeneeded",l=>{n(pe(s.result),l.oldVersion,l.newVersion,pe(s.transaction),l)}),r&&s.addEventListener("blocked",l=>r(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener("close",()=>o()),i&&l.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const no=["get","getKey","getAll","getAllKeys","count"],io=["put","add","delete","clear"],et=new Map;function Yt(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(et.get(e))return et.get(e);const r=e.replace(/FromIndex$/,""),n=e!==r,i=io.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||no.includes(r)))return;const o=async function(s,...a){const l=this.transaction(s,i?"readwrite":"readonly");let u=l.store;return n&&(u=u.index(a.shift())),(await Promise.all([u[r](...a),i&&l.done]))[0]};return et.set(e,o),o}_r(t=>({...t,get:(e,r,n)=>Yt(e,r)||t.get(e,r,n),has:(e,r)=>!!Yt(e,r)||t.has(e,r)}));const oo=["continue","continuePrimaryKey","advance"],Ht={},wt=new WeakMap,Lr=new WeakMap,so={get(t,e){if(!oo.includes(e))return t[e];let r=Ht[e];return r||(r=Ht[e]=function(...n){wt.set(this,Lr.get(this)[e](...n))}),r}};async function*ao(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const r=new Proxy(e,so);for(Lr.set(r,e),He.set(r,Et(e));e;)yield r,e=await(wt.get(r)||e.continue()),wt.delete(r)}function Qt(t,e){return e===Symbol.asyncIterator&&mt(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&mt(t,[IDBIndex,IDBObjectStore])}_r(t=>({...t,get(e,r,n){return Qt(e,r)?ao:t.get(e,r,n)},has(e,r){return Qt(e,r)||t.has(e,r)}}));var Dr=function(){function t(e){var r=this,n,i,o;this.minInterval=ti,this.maxInterval=ri,this.maxPersistedEventsSize=Zn,this.interval=this.minInterval,this._timeAtLastSplit=Date.now(),this.shouldSplitEventsList=function(s,a){var l=r.getStringSize(a),u=r.getEventsArraySize(s);return u+l>=r.maxPersistedEventsSize?!0:Date.now()-r.timeAtLastSplit>r.interval&&s.length?(r.interval=Math.min(r.maxInterval,r.interval+r.minInterval),r._timeAtLastSplit=Date.now(),!0):!1},this.loggerProvider=e.loggerProvider,this.minInterval=(n=e.minInterval)!==null&&n!==void 0?n:this.minInterval,this.maxInterval=(i=e.maxInterval)!==null&&i!==void 0?i:this.maxInterval,this.maxPersistedEventsSize=(o=e.maxPersistedEventsSize)!==null&&o!==void 0?o:this.maxPersistedEventsSize}return Object.defineProperty(t.prototype,"timeAtLastSplit",{get:function(){return this._timeAtLastSplit},enumerable:!1,configurable:!0}),t.prototype.getStringSize=function(e){return e.length},t.prototype.getEventsArraySize=function(e){var r,n,i=0;try{for(var o=W(e),s=o.next();!s.done;s=o.next()){var a=s.value;i+=this.getStringSize(a)}}catch(u){r={error:u}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}var l=2+Math.max(0,e.length-1)+e.length*2;return i+l},t}(),$e;(function(t){t.RECORDING="recording",t.SENT="sent"})($e||($e={}));var _e="sessionCurrentSequence",Ae="sequencesToSend",lo=function(){var t=$();return new Promise(function(e,r){if(!t)return r(new Error("Global scope not found"));if(!t.indexedDB)return r(new Error("Session Replay: cannot find indexedDB"));try{var n=t.indexedDB.open("keyval-store");n.onupgradeneeded=function(){n.result.version===1&&(n.result.close(),n.transaction&&n.transaction.abort(),t.indexedDB.deleteDatabase("keyval-store"),e())},n.onsuccess=function(){e(n.result)},n.onerror=function(){r(n.error)}}catch(i){r(i)}})},Xt=function(t){return P(void 0,void 0,void 0,function(){var e,r;return C(this,function(n){switch(n.label){case 0:return t.length>0?(e=10,r=t.splice(0,e),[4,Promise.all(r)]):[3,2];case 1:return n.sent(),[3,0];case 2:return[2]}})})},uo=function(t){var e,r;return t.objectStoreNames.contains(_e)||(r=t.createObjectStore(_e,{keyPath:"sessionId"})),t.objectStoreNames.contains(Ae)||(e=t.createObjectStore(Ae,{keyPath:"sequenceId",autoIncrement:!0}),e.createIndex("sessionId","sessionId")),{sequencesStore:e,currentSequenceStore:r}},co=function(t){return P(void 0,void 0,void 0,function(){return C(this,function(e){switch(e.label){case 0:return[4,Ar(t,1,{upgrade:uo})];case 1:return[2,e.sent()]}})})},fo=function(t){je(e,t);function e(r){var n=t.call(this,r)||this;return n.getSequencesToSend=function(){return P(n,void 0,void 0,function(){var i,o,s,a,l,u;return C(this,function(c){switch(c.label){case 0:return c.trys.push([0,5,,6]),i=[],[4,this.db.transaction("sequencesToSend").store.openCursor()];case 1:o=c.sent(),c.label=2;case 2:return o?(s=o.value,a=s.sessionId,l=s.events,i.push({events:l,sequenceId:o.key,sessionId:a}),[4,o.continue()]):[3,4];case 3:return o=c.sent(),[3,2];case 4:return[2,i];case 5:return u=c.sent(),this.loggerProvider.warn("".concat(Ee,": ").concat(u)),[3,6];case 6:return[2,void 0]}})})},n.storeCurrentSequence=function(i){return P(n,void 0,void 0,function(){var o,s,a;return C(this,function(l){switch(l.label){case 0:return l.trys.push([0,4,,5]),[4,this.db.get(_e,i)];case 1:return o=l.sent(),o?[4,this.db.put(Ae,{sessionId:i,events:o.events})]:[2,void 0];case 2:return s=l.sent(),[4,this.db.put(_e,{sessionId:i,events:[]})];case 3:return l.sent(),[2,_(_({},o),{sessionId:i,sequenceId:s})];case 4:return a=l.sent(),this.loggerProvider.warn("".concat(Ee,": ").concat(a)),[3,5];case 5:return[2,void 0]}})})},n.addEventToCurrentSequence=function(i,o){return P(n,void 0,void 0,function(){var s,a,l,u,c,f;return C(this,function(d){switch(d.label){case 0:return d.trys.push([0,10,,11]),s=this.db.transaction(_e,"readwrite"),[4,s.store.get(i)];case 1:return a=d.sent(),a?[3,3]:[4,s.store.put({sessionId:i,events:[o]})];case 2:return d.sent(),[2];case 3:return l=void 0,this.shouldSplitEventsList(a.events,o)?(l=a.events,[4,s.store.put({sessionId:i,events:[o]})]):[3,5];case 4:return d.sent(),[3,7];case 5:return u=a.events.concat(o),[4,s.store.put({sessionId:i,events:u})];case 6:d.sent(),d.label=7;case 7:return[4,s.done];case 8:return d.sent(),l?[4,this.storeSendingEvents(i,l)]:[2,void 0];case 9:return c=d.sent(),c?[2,{events:l,sessionId:i,sequenceId:c}]:[2,void 0];case 10:return f=d.sent(),this.loggerProvider.warn("".concat(Ee,": ").concat(f)),[3,11];case 11:return[2,void 0]}})})},n.storeSendingEvents=function(i,o){return P(n,void 0,void 0,function(){var s,a;return C(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,this.db.put(Ae,{sessionId:i,events:o})];case 1:return s=l.sent(),[2,s];case 2:return a=l.sent(),this.loggerProvider.warn("".concat(Ee,": ").concat(a)),[3,3];case 3:return[2,void 0]}})})},n.cleanUpSessionEventsStore=function(i,o){return P(n,void 0,void 0,function(){var s;return C(this,function(a){switch(a.label){case 0:if(!o)return[2];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.db.delete(Ae,o)];case 2:return a.sent(),[3,4];case 3:return s=a.sent(),this.loggerProvider.warn("".concat(Ee,": ").concat(s)),[3,4];case 4:return[2]}})})},n.transitionFromKeyValStore=function(i){return P(n,void 0,void 0,function(){var o,s,a,l,u,c,f,d,v=this;return C(this,function(m){switch(m.label){case 0:return m.trys.push([0,6,,7]),[4,lo()];case 1:if(o=m.sent(),!o)return[2];s=function(h,b){return P(v,void 0,void 0,function(){var w,y,E=this;return C(this,function(I){switch(I.label){case 0:return w=b.sessionSequences,y=[],Object.keys(w).forEach(function(R){var S=parseInt(R,10),p=w[S];if(S===b.currentSequenceId){var g=p.events.map(function(T){return P(E,void 0,void 0,function(){return C(this,function(L){return[2,this.addEventToCurrentSequence(h,T)]})})});y.push.apply(y,me([],J(g),!1))}else p.status!==$e.SENT&&y.push(E.storeSendingEvents(h,p.events))}),[4,Xt(y)];case 1:return I.sent(),[2]}})})},a="".concat(In,"_").concat(this.apiKey.substring(0,10)),m.label=2;case 2:return m.trys.push([2,4,,5]),l=o.transaction("keyval").objectStore("keyval").getAll(a),u=new Promise(function(h){l.onsuccess=function(b){return P(v,void 0,void 0,function(){var w,y,E,I=this;return C(this,function(R){switch(R.label){case 0:return w=b&&b.target.result,y=w&&w[0],y?(E=[],Object.keys(y).forEach(function(S){var p=parseInt(S,10),g=y[p];if(i===p)E.push(s(p,g));else{var T=g.sessionSequences;Object.keys(T).forEach(function(L){var A=parseInt(L,10);T[A].status!==$e.SENT&&E.push(I.storeSendingEvents(p,T[A].events))})}}),[4,Xt(E)]):[3,2];case 1:R.sent(),R.label=2;case 2:return h(),[2]}})})}}),[4,u];case 3:return m.sent(),c=$(),c&&c.indexedDB.deleteDatabase("keyval-store"),[3,5];case 4:return f=m.sent(),this.loggerProvider.warn("Failed to transition session replay events from keyval to new store: ".concat(f)),[3,5];case 5:return[3,7];case 6:return d=m.sent(),this.loggerProvider.warn("Failed to access keyval store: ".concat(d,". For more information, visit: https://www.docs.developers.amplitude.com/session-replay/sdks/standalone/#indexeddb-best-practices")),[3,7];case 7:return[2]}})})},n.apiKey=r.apiKey,n.db=r.db,n}return e.new=function(r,n,i){return P(this,void 0,void 0,function(){var o,s,a,l,u;return C(this,function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),o=r==="replay"?"":"_".concat(r),s="".concat(n.apiKey.substring(0,10),"_amp_session_replay_events").concat(o),[4,co(s)];case 1:return a=c.sent(),l=new e(_(_({},n),{db:a})),[4,l.transitionFromKeyValStore(i)];case 2:return c.sent(),[2,l];case 3:return u=c.sent(),n.loggerProvider.warn("".concat(Ee,": ").concat(u)),[3,4];case 4:return[2]}})})},e.prototype.getCurrentSequenceEvents=function(r){return P(this,void 0,void 0,function(){var s,n,i,o,s,a,l,u;return C(this,function(c){switch(c.label){case 0:return r?[4,this.db.get("sessionCurrentSequence",r)]:[3,2];case 1:return s=c.sent(),s?[2,[s]]:[2,void 0];case 2:n=[],c.label=3;case 3:return c.trys.push([3,8,9,10]),[4,this.db.getAll("sessionCurrentSequence")];case 4:i=W.apply(void 0,[c.sent()]),o=i.next(),c.label=5;case 5:if(o.done)return[3,7];s=o.value,n.push(s),c.label=6;case 6:return o=i.next(),[3,5];case 7:return[3,10];case 8:return a=c.sent(),l={error:a},[3,10];case 9:try{o&&!o.done&&(u=i.return)&&u.call(i)}finally{if(l)throw l.error}return[7];case 10:return[2,n]}})})},e}(Dr),vo=function(t){je(e,t);function e(){var r=t!==null&&t.apply(this,arguments)||this;return r.finalizedSequences={},r.sequences={},r.sequenceId=0,r}return e.prototype.resetCurrentSequence=function(r){this.sequences[r]=[]},e.prototype.addSequence=function(r){var n=this.sequenceId++,i=me([],J(this.sequences[r]),!1);return this.finalizedSequences[n]={sessionId:r,events:i},this.resetCurrentSequence(r),{sequenceId:n,events:i,sessionId:r}},e.prototype.getSequencesToSend=function(){return P(this,void 0,void 0,function(){return C(this,function(r){return[2,Object.entries(this.finalizedSequences).map(function(n){var i=J(n,2),o=i[0],s=i[1],a=s.sessionId,l=s.events;return{sequenceId:Number(o),sessionId:a,events:l}})]})})},e.prototype.storeCurrentSequence=function(r){return P(this,void 0,void 0,function(){return C(this,function(n){return this.sequences[r]?[2,this.addSequence(r)]:[2,void 0]})})},e.prototype.addEventToCurrentSequence=function(r,n){return P(this,void 0,void 0,function(){var i;return C(this,function(o){return this.sequences[r]||this.resetCurrentSequence(r),this.shouldSplitEventsList(this.sequences[r],n)&&(i=this.addSequence(r)),this.sequences[r].push(n),[2,i]})})},e.prototype.storeSendingEvents=function(r,n){return P(this,void 0,void 0,function(){return C(this,function(i){return this.finalizedSequences[this.sequenceId]={sessionId:r,events:n},[2,this.sequenceId++]})})},e.prototype.cleanUpSessionEventsStore=function(r,n){return P(this,void 0,void 0,function(){return C(this,function(i){return n!==void 0&&delete this.finalizedSequences[n],[2]})})},e}(Dr),Zt=function(t){var e=t.config,r=t.sessionId,n=t.minInterval,i=t.maxInterval,o=t.type,s=t.payloadBatcher,a=t.storeType;return P(void 0,void 0,void 0,function(){function l(y){return y===void 0&&(y=!1),P(this,void 0,void 0,function(){return C(this,function(E){return[2,u.flush(y)]})})}var u,c,f,d,v,m,h,b,w;return C(this,function(y){switch(y.label){case 0:return u=new Qi(_(_({},e),{loggerProvider:e.loggerProvider,payloadBatcher:s})),c=function(){return new vo({loggerProvider:e.loggerProvider,maxInterval:i,minInterval:n})},f=function(){return P(void 0,void 0,void 0,function(){var E;return C(this,function(I){switch(I.label){case 0:return[4,fo.new(o,{loggerProvider:e.loggerProvider,minInterval:n,maxInterval:i,apiKey:e.apiKey},r)];case 1:return E=I.sent(),e.loggerProvider.log("Failed to initialize idb store, falling back to memory store."),[2,E??c()]}})})},a!=="idb"?[3,2]:[4,f()];case 1:return v=y.sent(),[3,3];case 2:v=c(),y.label=3;case 3:return d=v,m=function(E){var I=E.events,R=E.sessionId,S=E.deviceId,p=E.sequenceId;e.debugMode&&Sr().then(function(g){var T=g.totalStorageSize,L=g.percentOfQuota,A=g.usageDetails;e.loggerProvider.debug("Total storage size: ".concat(T," KB, percentage of quota: ").concat(L,"%, usage details: ").concat(A))}).catch(function(){}),u.sendEventsList({events:I,sessionId:R,flushMaxRetries:e.flushMaxRetries,apiKey:e.apiKey,deviceId:S,sampleRate:e.sampleRate,serverZone:e.serverZone,version:e.version,type:o,onComplete:function(){return P(void 0,void 0,void 0,function(){return C(this,function(g){switch(g.label){case 0:return[4,d.cleanUpSessionEventsStore(R,p)];case 1:return g.sent(),[2]}})})}})},h=function(E){var I=E.sessionId,R=E.deviceId;d.storeCurrentSequence(I).then(function(S){S&&m({sequenceId:S.sequenceId,events:S.events,sessionId:S.sessionId,deviceId:R})}).catch(function(S){e.loggerProvider.warn("Failed to get current sequence of session replay events for session:",S)})},b=function(E){var I=E.deviceId;return P(void 0,void 0,void 0,function(){var R;return C(this,function(S){switch(S.label){case 0:return[4,d.getSequencesToSend()];case 1:return R=S.sent(),R&&R.forEach(function(p){m({sequenceId:p.sequenceId,events:p.events,sessionId:p.sessionId,deviceId:I})}),[2]}})})},w=function(E){var I=E.event,R=E.sessionId,S=E.deviceId;d.addEventToCurrentSequence(R,I.data).then(function(p){return p&&m({sequenceId:p.sequenceId,events:p.events,sessionId:p.sessionId,deviceId:S})}).catch(function(p){e.loggerProvider.warn("Failed to add event to session replay capture:",p)})},[2,{sendCurrentSequenceEvents:h,addEvent:w,sendStoredEvents:b,flush:l}]}})})},Jt=function(){function t(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=new Map;e.forEach(function(i){n.set(i.name,i.manager)}),this.managers=n}return t.prototype.sendStoredEvents=function(e){return P(this,void 0,void 0,function(){var r;return C(this,function(n){switch(n.label){case 0:return r=[],this.managers.forEach(function(i){r.push(i.sendStoredEvents(e))}),[4,Promise.all(r)];case 1:return n.sent(),[2]}})})},t.prototype.addEvent=function(e){var r,n=e.sessionId,i=e.event,o=e.deviceId;(r=this.managers.get(i.type))===null||r===void 0||r.addEvent({sessionId:n,event:i,deviceId:o})},t.prototype.sendCurrentSequenceEvents=function(e){var r=e.sessionId,n=e.deviceId;this.managers.forEach(function(i){i.sendCurrentSequenceEvents({sessionId:r,deviceId:n})})},t.prototype.flush=function(e){return P(this,void 0,void 0,function(){var r;return C(this,function(n){switch(n.label){case 0:return r=[],this.managers.forEach(function(i){r.push(i.flush(e))}),[4,Promise.all(r)];case 1:return n.sent(),[2]}})})},t}();const er={Node:["childNodes","parentNode","parentElement","textContent"],ShadowRoot:["host","styleSheets"],Element:["shadowRoot","querySelector","querySelectorAll"],MutationObserver:[]},tr={Node:["contains","getRootNode"],ShadowRoot:["getSelection"],Element:[],MutationObserver:["constructor"]},ke={};function ho(t){var e,r;const n=(r=(e=globalThis?.Zone)==null?void 0:e.__symbol__)==null?void 0:r.call(e,t);if(n&&globalThis[n])return globalThis[n]}function Tt(t){if(ke[t])return ke[t];const e=ho(t)||globalThis[t],r=e.prototype,n=t in er?er[t]:void 0,i=!!(n&&n.every(a=>{var l,u;return!!((u=(l=Object.getOwnPropertyDescriptor(r,a))==null?void 0:l.get)!=null&&u.toString().includes("[native code]"))})),o=t in tr?tr[t]:void 0,s=!!(o&&o.every(a=>{var l;return typeof r[a]=="function"&&((l=r[a])==null?void 0:l.toString().includes("[native code]"))}));if(i&&s)return ke[t]=e.prototype,e.prototype;try{const a=document.createElement("iframe");document.body.appendChild(a);const l=a.contentWindow;if(!l)return e.prototype;const u=l[t].prototype;return document.body.removeChild(a),u?ke[t]=u:r}catch{return r}}const tt={};function ce(t,e,r){var n;const i=`${t}.${String(r)}`;if(tt[i])return tt[i].call(e);const o=Tt(t),s=(n=Object.getOwnPropertyDescriptor(o,r))==null?void 0:n.get;return s?(tt[i]=s,s.call(e)):e[r]}const rt={};function Mr(t,e,r){const n=`${t}.${String(r)}`;if(rt[n])return rt[n].bind(e);const o=Tt(t)[r];return typeof o!="function"?e[r]:(rt[n]=o,o.bind(e))}function go(t){return ce("Node",t,"childNodes")}function po(t){return ce("Node",t,"parentNode")}function mo(t){return ce("Node",t,"parentElement")}function yo(t){return ce("Node",t,"textContent")}function So(t,e){return Mr("Node",t,"contains")(e)}function Eo(t){return Mr("Node",t,"getRootNode")()}function wo(t){return!t||!("host"in t)?null:ce("ShadowRoot",t,"host")}function bo(t){return t.styleSheets}function Io(t){return!t||!("shadowRoot"in t)?null:ce("Element",t,"shadowRoot")}function Ro(t,e){return ce("Element",t,"querySelector")(e)}function Co(t,e){return ce("Element",t,"querySelectorAll")(e)}function Po(){return Tt("MutationObserver").constructor}const rr={childNodes:go,parentNode:po,parentElement:mo,textContent:yo,contains:So,getRootNode:Eo,host:wo,styleSheets:bo,shadowRoot:Io,querySelector:Ro,querySelectorAll:Co,mutationObserver:Po};function To(t){var e,r,n,i,o=t.document;return{left:o.scrollingElement?o.scrollingElement.scrollLeft:t.pageXOffset!==void 0?t.pageXOffset:o.documentElement.scrollLeft||o?.body&&((e=rr.parentElement(o.body))===null||e===void 0?void 0:e.scrollLeft)||((r=o?.body)===null||r===void 0?void 0:r.scrollLeft)||0,top:o.scrollingElement?o.scrollingElement.scrollTop:t.pageYOffset!==void 0?t.pageYOffset:o?.documentElement.scrollTop||o?.body&&((n=rr.parentElement(o.body))===null||n===void 0?void 0:n.scrollTop)||((i=o?.body)===null||i===void 0?void 0:i.scrollTop)||0}}function nt(){var t=$();return t?.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight||0}function it(){var t=$();return t?.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth||0}var X,_t,kr;function _o(t,e){if(kr=new Date,t.nodeType!==Node.ELEMENT_NODE)throw new Error("Can't generate CSS selector for non-element node type.");if(t.tagName.toLowerCase()==="html")return"html";var r={root:document.body,idName:function(o){return!0},className:function(o){return!0},tagName:function(o){return!0},attr:function(o,s){return!1},seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4,timeoutMs:void 0};X=_(_({},r),e),_t=Ao(X.root,r);var n=Oe(t,"all",function(){return Oe(t,"two",function(){return Oe(t,"one",function(){return Oe(t,"none")})})});if(n){var i=Ur(Nr(n,t));return i.length>0&&(n=i[0]),Qe(n)}else throw new Error("Selector was not found.")}function Ao(t,e){return t.nodeType===Node.DOCUMENT_NODE?t:t===e.root?t.ownerDocument:t}function Oe(t,e,r){for(var n=null,i=[],o=t,s=0,a=function(){var u,c,f=new Date().getTime()-kr.getTime();if(X.timeoutMs!==void 0&&f>X.timeoutMs)throw new Error("Timeout: Can't find a unique selector after ".concat(f,"ms"));var d=Ue(Lo(o))||Ue.apply(void 0,me([],J(Do(o)),!1))||Ue.apply(void 0,me([],J(Mo(o)),!1))||Ue(ko(o))||[or()],v=Oo(o);if(e=="all")v&&(d=d.concat(d.filter(ot).map(function(y){return xe(y,v)})));else if(e=="two")d=d.slice(0,1),v&&(d=d.concat(d.filter(ot).map(function(y){return xe(y,v)})));else if(e=="one"){var m=J(d=d.slice(0,1),1),h=m[0];v&&ot(h)&&(d=[xe(h,v)])}else e=="none"&&(d=[or()],v&&(d=[xe(d[0],v)]));try{for(var b=(u=void 0,W(d)),w=b.next();!w.done;w=b.next()){var h=w.value;h.level=s}}catch(y){u={error:y}}finally{try{w&&!w.done&&(c=b.return)&&c.call(b)}finally{if(u)throw u.error}}if(i.push(d),i.length>=X.seedMinLength&&(n=nr(i,r),n))return"break";o=o.parentElement,s++};o;){var l=a();if(l==="break")break}return n||(n=nr(i,r)),!n&&r?r():n}function nr(t,e){var r,n,i=Ur(xr(t));if(i.length>X.threshold)return e?e():null;try{for(var o=W(i),s=o.next();!s.done;s=o.next()){var a=s.value;if(Or(a))return a}}catch(l){r={error:l}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return null}function Qe(t){for(var e=t[0],r=e.name,n=1;n<t.length;n++){var i=t[n].level||0;e.level===i-1?r="".concat(t[n].name," > ").concat(r):r="".concat(t[n].name," ").concat(r),e=t[n]}return r}function ir(t){return t.map(function(e){return e.penalty}).reduce(function(e,r){return e+r},0)}function Or(t){var e=Qe(t);switch(_t.querySelectorAll(e).length){case 0:throw new Error("Can't select any node with this selector: ".concat(e));case 1:return!0;default:return!1}}function Lo(t){var e=t.getAttribute("id");return e&&X.idName(e)?{name:"#"+CSS.escape(e),penalty:0}:null}function Do(t){var e=Array.from(t.attributes).filter(function(r){return X.attr(r.name,r.value)});return e.map(function(r){return{name:"[".concat(CSS.escape(r.name),'="').concat(CSS.escape(r.value),'"]'),penalty:.5}})}function Mo(t){var e=Array.from(t.classList).filter(X.className);return e.map(function(r){return{name:"."+CSS.escape(r),penalty:1}})}function ko(t){var e=t.tagName.toLowerCase();return X.tagName(e)?{name:e,penalty:2}:null}function or(){return{name:"*",penalty:3}}function Oo(t){var e=t.parentNode;if(!e)return null;var r=e.firstChild;if(!r)return null;for(var n=0;r&&(r.nodeType===Node.ELEMENT_NODE&&n++,r!==t);)r=r.nextSibling;return n}function xe(t,e){return{name:t.name+":nth-child(".concat(e,")"),penalty:t.penalty+1}}function ot(t){return t.name!=="html"&&!t.name.startsWith("#")}function Ue(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t.filter(xo);return r.length>0?r:null}function xo(t){return t!=null}function xr(t,e){var r,n,i,o,s,a;return e===void 0&&(e=[]),C(this,function(l){switch(l.label){case 0:if(!(t.length>0))return[3,9];l.label=1;case 1:l.trys.push([1,6,7,8]),r=W(t[0]),n=r.next(),l.label=2;case 2:return n.done?[3,5]:(i=n.value,[5,W(xr(t.slice(1,t.length),e.concat(i)))]);case 3:l.sent(),l.label=4;case 4:return n=r.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{n&&!n.done&&(a=r.return)&&a.call(r)}finally{if(s)throw s.error}return[7];case 8:return[3,11];case 9:return[4,e];case 10:l.sent(),l.label=11;case 11:return[2]}})}function Ur(t){return me([],J(t),!1).sort(function(e,r){return ir(e)-ir(r)})}function Nr(t,e,r){var n,i,o;return r===void 0&&(r={counter:0,visited:new Map}),C(this,function(s){switch(s.label){case 0:if(!(t.length>2&&t.length>X.optimizedMinLength))return[3,5];n=1,s.label=1;case 1:return n<t.length-1?r.counter>X.maxNumberOfTries?[2]:(r.counter+=1,i=me([],J(t),!1),i.splice(n,1),o=Qe(i),r.visited.has(o)?[2]:Or(i)&&Uo(i,e)?[4,i]:[3,4]):[3,5];case 2:return s.sent(),r.visited.set(o,!0),[5,W(Nr(i,e,r))];case 3:s.sent(),s.label=4;case 4:return n++,[3,1];case 5:return[2]}})}function Uo(t,e){return _t.querySelector(Qe(t))===e}var No=36e5,Bo=function(t){var e=t.version,r=t.events,n=[];return r.forEach(function(i){var o=JSON.parse(i);o.count=1,o.type==="click"&&n.push(o)}),{version:e,events:n}},Fo=function(t){var e=t.version,r=t.events,n=[];r.forEach(function(o){var s=JSON.parse(o);s.type==="click"&&n.push(s)});var i=n.reduce(function(o,s){var a=s.x,l=s.y,u=s.selector,c=s.timestamp,f=c-c%No,d="".concat(a,":").concat(l,":").concat(u??"",":").concat(f);return o[d]?o[d].count+=1:o[d]=_(_({},s),{timestamp:f,count:1}),o},{});return{version:e,events:Object.values(i)}},qo=function(t,e){var r=e.eventsManager,n=e.sessionId,i=e.deviceIdFn,o=e.mirror,s=e.ugcFilterRules;return function(a){if(a.type===Ir.Click){var l=$();if(l){var u=l.location,c=l.innerHeight,f=l.innerWidth;if(u){var d=a.x,v=a.y;if(!(d===void 0||v===void 0)){var m=o.getNode(a.id),h;if(m)try{h=_o(m)}catch{t.debug("error resolving selector from finder")}var b=To(l),w=b.left,y=b.top,E=Ye(u.href,s),I={x:d+w,y:v+y,selector:h,viewportHeight:c,viewportWidth:f,pageUrl:E,timestamp:Date.now(),type:"click"},R=i();R&&r.addEvent({sessionId:n,event:{type:"interaction",data:JSON.stringify(I)},deviceId:R})}}}}}},Ko=function(){function t(e,r){var n=$();n&&n.navigator&&typeof n.navigator.sendBeacon=="function"?this.sendBeacon=function(i,o){try{if(n.navigator.sendBeacon(i,JSON.stringify(o)))return!0}catch{}return!1}:this.sendBeacon=function(){return!1},this.sendXhr=function(i,o){var s=new XMLHttpRequest;return s.open("POST",i,!0),s.setRequestHeader("Accept","*/*"),s.send(JSON.stringify(o)),!0},this.basePageUrl=yr(r.serverZone,r.trackServerUrl),this.apiKey=r.apiKey,this.context=e}return t.prototype.send=function(e,r){var n=this.context,i=n.sessionId,o=n.type,s=new URLSearchParams({device_id:e,session_id:String(i),type:String(o),api_key:this.apiKey}),a="".concat(this.basePageUrl,"?").concat(s.toString());this.sendBeacon(a,r)||this.sendXhr(a,r)},t}(),Go=function(){function t(e,r){var n=this;this.timestamp=Date.now(),this.hook=function(i){n.update(i)},this.send=function(i){return function(o){var s,a,l=i(),u=$();u&&l&&n.transport.send(l,{version:1,events:[{maxScrollX:n._maxScrollX,maxScrollY:n._maxScrollY,maxScrollWidth:n._maxScrollWidth,maxScrollHeight:n._maxScrollHeight,viewportHeight:nt(),viewportWidth:it(),pageUrl:Ye(u.location.href,(a=(s=n.config.interactionConfig)===null||s===void 0?void 0:s.ugcFilterRules)!==null&&a!==void 0?a:[]),timestamp:n.timestamp,type:"scroll"}]})}},this._maxScrollX=0,this._maxScrollY=0,this._maxScrollWidth=it(),this._maxScrollHeight=nt(),this.config=r,this.transport=e}return t.default=function(e,r){return new t(new Ko(e,r),r)},Object.defineProperty(t.prototype,"maxScrollX",{get:function(){return this._maxScrollX},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScrollY",{get:function(){return this._maxScrollY},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScrollWidth",{get:function(){return this._maxScrollWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScrollHeight",{get:function(){return this._maxScrollHeight},enumerable:!1,configurable:!0}),t.prototype.update=function(e){var r=Date.now();if(e.x>this._maxScrollX){var n=it();this._maxScrollX=e.x;var i=e.x+n;i>this._maxScrollWidth&&(this._maxScrollWidth=i),this.timestamp=r}if(e.y>this._maxScrollY){var o=nt();this._maxScrollY=e.y;var s=e.y+o;s>this._maxScrollHeight&&(this._maxScrollHeight=s),this.timestamp=r}},t}(),sr=function(){function t(e){var r=e.sessionId,n=e.deviceId;this.deviceId=n,this.sessionId=r,r&&n&&(this.sessionReplayId=li(r,n))}return t}(),Vo=1e3*60*60*24*2,zo=function(){function t(){var e=this;this.dbs={},this.createStore=function(r){return P(e,void 0,void 0,function(){return C(this,function(n){switch(n.label){case 0:return[4,Ar(r,1,{upgrade:function(i){i.objectStoreNames.contains("sessionTargetingMatch")||i.createObjectStore("sessionTargetingMatch",{keyPath:"sessionId"})}})];case 1:return[2,n.sent()]}})})},this.openOrCreateDB=function(r){return P(e,void 0,void 0,function(){var n,i;return C(this,function(o){switch(o.label){case 0:return this.dbs&&this.dbs[r]?[2,this.dbs[r]]:(n="".concat(r.substring(0,10),"_amp_session_replay_targeting"),[4,this.createStore(n)]);case 1:return i=o.sent(),this.dbs[r]=i,[2,i]}})})},this.getTargetingMatchForSession=function(r){var n=r.loggerProvider,i=r.apiKey,o=r.sessionId;return P(e,void 0,void 0,function(){var s,a,l,u;return C(this,function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),[4,this.openOrCreateDB(i)];case 1:return s=c.sent(),a=String(o),[4,s.get("sessionTargetingMatch",a)];case 2:return l=c.sent(),[2,l?.targetingMatch];case 3:return u=c.sent(),n.warn("Failed to get targeting match for session id ".concat(o,": ").concat(u)),[3,4];case 4:return[2,void 0]}})})},this.storeTargetingMatchForSession=function(r){var n=r.loggerProvider,i=r.apiKey,o=r.sessionId,s=r.targetingMatch;return P(e,void 0,void 0,function(){var a,l,u,c;return C(this,function(f){switch(f.label){case 0:return f.trys.push([0,3,,4]),[4,this.openOrCreateDB(i)];case 1:return a=f.sent(),l=String(o),[4,a.put("sessionTargetingMatch",{targetingMatch:s,sessionId:l,lastUpdated:Date.now()})];case 2:return u=f.sent(),[2,u];case 3:return c=f.sent(),n.warn("Failed to store targeting match for session id ".concat(o,": ").concat(c)),[3,4];case 4:return[2,void 0]}})})},this.clearStoreOfOldSessions=function(r){var n=r.loggerProvider,i=r.apiKey,o=r.currentSessionId;return P(e,void 0,void 0,function(){var s,a,l,u,c,f,d,v;return C(this,function(m){switch(m.label){case 0:return m.trys.push([0,8,,9]),[4,this.openOrCreateDB(i)];case 1:return s=m.sent(),a=String(o),l=s.transaction("sessionTargetingMatch","readwrite"),[4,l.store.getAll()];case 2:u=m.sent(),c=0,m.label=3;case 3:return c<u.length?(f=u[c],d=Date.now()-f.lastUpdated,f.sessionId!==a&&d>Vo?[4,l.store.delete(f.sessionId)]:[3,5]):[3,6];case 4:m.sent(),m.label=5;case 5:return c++,[3,3];case 6:return[4,l.done];case 7:return m.sent(),[3,9];case 8:return v=m.sent(),n.warn("Failed to clear old targeting matches for sessions: ".concat(v)),[3,9];case 9:return[2]}})})}}return t}(),st=new zo,Wo=function(t){var e=t.sessionId,r=t.targetingConfig,n=t.loggerProvider,i=t.apiKey,o=t.targetingParams;return P(void 0,void 0,void 0,function(){var s,a,l,u,c,f;return C(this,function(d){switch(d.label){case 0:return[4,st.clearStoreOfOldSessions({loggerProvider:n,apiKey:i,currentSessionId:e})];case 1:return d.sent(),[4,st.getTargetingMatchForSession({loggerProvider:n,apiKey:i,sessionId:e})];case 2:if(s=d.sent(),s===!0)return[2,!0];a=!0,d.label=3;case 3:return d.trys.push([3,6,,7]),[4,Pe(()=>import("./index.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url)];case 4:return l=d.sent().evaluateTargeting,[4,l(_(_({},o),{flag:r,sessionId:e,apiKey:i,loggerProvider:n}))];case 5:return u=d.sent(),u&&u.sr_targeting_config&&(a=u.sr_targeting_config.key==="on"),st.storeTargetingMatchForSession({loggerProvider:n,apiKey:i,sessionId:e,targetingMatch:a}),[3,7];case 6:return c=d.sent(),f=c,n.warn(f.message),[3,7];case 7:return[2,a]}})})};function Br(t){return t===void 0&&(t={}),{name:"amplitude/url-tracking@1",observer:function(e,r,n){var i,o,s,a=_(_({},t),n),l=a.ugcFilterRules||[],u=(i=a.enablePolling)!==null&&i!==void 0?i:!1,c=(o=a.pollingInterval)!==null&&o!==void 0?o:hr,f=(s=a.captureDocumentTitle)!==null&&s!==void 0?s:!1;if(!r)return function(){};var d=void 0,v=function(){return r.location&&r.location.href||""},m=function(){var S=r.innerHeight,p=r.innerWidth,g=r.document,T=v(),L="";f&&(L=g?.title||"");var A=l.length>0?Ye(T,l):T;return{href:A,title:L,viewportHeight:S,viewportWidth:p,type:"url-change-event"}},h=function(){var S=v();if(d===void 0||S!==d){d=S;var p=m();e(p)}},b=function(S){return function(){for(var p=[],g=0;g<arguments.length;g++)p[g]=arguments[g];var T=S.apply(this,p);return h(),T}},w=function(){h()};if(u){var y=r.setInterval(function(){h()},c);return h(),function(){y&&r.clearInterval(y)}}if(r.history){var E=r.history.pushState.bind(r.history),I=r.history.replaceState.bind(r.history),R=function(){r.history.pushState=b(E),r.history.replaceState=b(I)};return R(),r.addEventListener("popstate",h),r.addEventListener("hashchange",w),h(),function(){r.history.pushState=E,r.history.replaceState=I,r.removeEventListener("popstate",h),r.removeEventListener("hashchange",w)}}return r.addEventListener("hashchange",w),h(),function(){r.removeEventListener("hashchange",w)}},options:t}}Br();var $o=function(){function t(){var e=this;this.name="@amplitude/session-replay-browser",this.recordCancelCallback=null,this.eventCount=0,this.sessionTargetingMatch=!1,this.pageLeaveFns=[],this.recordFunction=null,this.teardownEventListeners=function(r){var n=$();n&&(n.removeEventListener("blur",e.blurListener),n.removeEventListener("focus",e.focusListener),!r&&n.addEventListener("blur",e.blurListener),!r&&n.addEventListener("focus",e.focusListener),n.self&&"onpagehide"in n.self?(n.removeEventListener("pagehide",e.pageLeaveListener),!r&&n.addEventListener("pagehide",e.pageLeaveListener)):(n.removeEventListener("beforeunload",e.pageLeaveListener),!r&&n.addEventListener("beforeunload",e.pageLeaveListener)))},this.blurListener=function(){e.sendEvents()},this.focusListener=function(){e.recordEvents(!1)},this.pageLeaveListener=function(r){e.pageLeaveFns.forEach(function(n){n(r)})},this.evaluateTargetingAndCapture=function(r,n){return n===void 0&&(n=!1),P(e,void 0,void 0,function(){var i,o;return C(this,function(s){switch(s.label){case 0:if(!this.identifiers||!this.identifiers.sessionId||!this.config)return this.identifiers&&!this.identifiers.sessionId?this.loggerProvider.log("Session ID has not been set yet, cannot evaluate targeting for Session Replay."):this.loggerProvider.warn("Session replay init has not been called, cannot evaluate targeting."),[2];if(!this.config.targetingConfig)if(n)this.loggerProvider.log("Targeting config has not been set yet, cannot evaluate targeting.");else return this.loggerProvider.log("No targeting config set, skipping initialization/recording for event."),[2];return this.lastTargetingParams=r,this.config.targetingConfig&&!this.sessionTargetingMatch?(i=r.event,i&&Object.values(lt).includes(i.event_type)&&(i=void 0),o=this,[4,Wo({sessionId:this.identifiers.sessionId,targetingConfig:this.config.targetingConfig,loggerProvider:this.loggerProvider,apiKey:this.config.apiKey,targetingParams:{userProperties:r.userProperties,event:i}})]):[3,2];case 1:o.sessionTargetingMatch=s.sent(),this.loggerProvider.debug(JSON.stringify({name:"targeted replay capture config",sessionTargetingMatch:this.sessionTargetingMatch,event:i,targetingParams:r},null,2)),s.label=2;case 2:return n?(this.initialize(!0),[3,5]):[3,3];case 3:return[4,this.recordEvents()];case 4:s.sent(),s.label=5;case 5:return[2]}})})},this.addCustomRRWebEvent=function(r,n,i){return n===void 0&&(n={}),i===void 0&&(i=!0),P(e,void 0,void 0,function(){var o,s,a,l;return C(this,function(u){switch(u.label){case 0:return u.trys.push([0,3,,4]),o=void 0,s=this.config,s&&r!==ue.METADATA?(o={config:Er(s),version:pt},i?[4,Sr()]:[3,2]):[3,2];case 1:a=u.sent(),o=_(_({},a),o),u.label=2;case 2:return this.recordCancelCallback&&this.recordFunction?this.recordFunction.addCustomEvent(r,_(_({},n),o)):this.loggerProvider.debug("Not able to add custom replay capture event ".concat(r," due to no ongoing recording.")),[3,4];case 3:return l=u.sent(),this.loggerProvider.debug("Error while adding custom replay capture event: ",l),[3,4];case 4:return[2]}})})},this.stopRecordingEvents=function(){var r;try{e.loggerProvider.log("Session Replay capture stopping."),e.recordCancelCallback&&e.recordCancelCallback(),e.recordCancelCallback=null,(r=e.networkObservers)===null||r===void 0||r.stop()}catch(i){var n=i;e.loggerProvider.warn("Error occurred while stopping replay capture: ".concat(n.toString()))}},this.loggerProvider=new ct(new Ve)}return t.prototype.init=function(e,r){return Ut(this._init(e,r))},t.prototype._init=function(e,r){var n,i,o,s,a,l,u;return P(this,void 0,void 0,function(){var c,f,d,v,m,h,b,w,y,E,p,I,R,S,p,g,T,L;return C(this,function(A){switch(A.label){case 0:return this.loggerProvider=new ct(r.loggerProvider||new Ve),Object.prototype.hasOwnProperty.call(r,"logLevel")&&this.loggerProvider.enable(r.logLevel),this.identifiers=new sr({sessionId:r.sessionId,deviceId:r.deviceId}),c=this,[4,Ti(e,r)];case 1:return c.joinedConfigGenerator=A.sent(),[4,this.joinedConfigGenerator.generateJoinedConfig(this.identifiers.sessionId)];case 2:f=A.sent(),d=f.joinedConfig,v=f.localConfig,m=f.remoteConfig,this.config=d,this.setMetadata(r.sessionId,d,v,m,(n=r.version)===null||n===void 0?void 0:n.version,pt,(i=r.version)===null||i===void 0?void 0:i.type),r.sessionId&&(!((o=this.config.interactionConfig)===null||o===void 0)&&o.enabled)&&(h=Go.default({sessionId:r.sessionId,type:"interaction"},this.config),this.pageLeaveFns=[h.send(this.getDeviceId.bind(this)).bind(h)],this.scrollHook=h.hook.bind(h)),b=[],w=this.config.storeType,w==="idb"&&!(!((s=$())===null||s===void 0)&&s.indexedDB)&&(w="memory",this.loggerProvider.warn("Could not use preferred indexedDB storage, reverting to in memory option.")),this.loggerProvider.log("Using ".concat(w," for event storage.")),A.label=3;case 3:return A.trys.push([3,5,,6]),[4,Zt({config:this.config,sessionId:this.identifiers.sessionId,type:"replay",storeType:w})];case 4:return y=A.sent(),b.push({name:"replay",manager:y}),[3,6];case 5:return E=A.sent(),p=E,this.loggerProvider.warn("Error occurred while creating replay events manager: ".concat(p.toString())),[3,6];case 6:if(!(!((a=this.config.interactionConfig)===null||a===void 0)&&a.enabled))return[3,10];I=this.config.interactionConfig.batch?Fo:Bo,A.label=7;case 7:return A.trys.push([7,9,,10]),[4,Zt({config:this.config,sessionId:this.identifiers.sessionId,type:"interaction",minInterval:(l=this.config.interactionConfig.trackEveryNms)!==null&&l!==void 0?l:Jn,maxInterval:ei,payloadBatcher:I,storeType:w})];case 8:return R=A.sent(),b.push({name:"interaction",manager:R}),[3,10];case 9:return S=A.sent(),p=S,this.loggerProvider.warn("Error occurred while creating interaction events manager: ".concat(p.toString())),[3,10];case 10:return this.eventsManager=new(Jt.bind.apply(Jt,me([void 0],J(b),!1))),this.eventCompressor&&this.eventCompressor.terminate(),g=void 0,T=$(),!((u=this.config.experimental)===null||u===void 0)&&u.useWebWorker&&T&&T.Worker?[4,Pe(()=>import("./index2.js"),[],import.meta.url)]:[3,12];case 11:L=A.sent().compressionScript,g=L,A.label=12;case 12:return this.eventCompressor=new zi(this.eventsManager,this.config,this.getDeviceId(),g),[4,this.initializeNetworkObservers()];case 13:return A.sent(),this.loggerProvider.log("Installing @amplitude/session-replay-browser."),this.teardownEventListeners(!1),[4,this.evaluateTargetingAndCapture({userProperties:r.userProperties},!0)];case 14:return A.sent(),[2]}})})},t.prototype.setSessionId=function(e,r){return Ut(this.asyncSetSessionId(e,r))},t.prototype.asyncSetSessionId=function(e,r,n){var i;return P(this,void 0,void 0,function(){var o,s,a;return C(this,function(l){switch(l.label){case 0:return this.sessionTargetingMatch=!1,this.lastShouldRecordDecision=void 0,o=this.identifiers&&this.identifiers.sessionId,o&&this.sendEvents(o),s=r||this.getDeviceId(),this.identifiers=new sr({sessionId:e,deviceId:s}),this.joinedConfigGenerator&&o?[4,this.joinedConfigGenerator.generateJoinedConfig(this.identifiers.sessionId)]:[3,2];case 1:a=l.sent().joinedConfig,this.config=a,l.label=2;case 2:return!((i=this.config)===null||i===void 0)&&i.targetingConfig?[4,this.evaluateTargetingAndCapture({userProperties:n?.userProperties})]:[3,4];case 3:return l.sent(),[3,6];case 4:return[4,this.recordEvents()];case 5:l.sent(),l.label=6;case 6:return[2]}})})},t.prototype.getSessionReplayProperties=function(){var e,r=this.config,n=this.identifiers;if(!r||!n)return this.loggerProvider.warn("Session replay init has not been called, cannot get session replay properties."),{};var i=this.getShouldRecord(),o={};return i&&(o=(e={},e[Gn]=n.sessionReplayId?n.sessionReplayId:null,e),r.debugMode&&(o[$n]=JSON.stringify({appHash:ut(r.apiKey).toString()}))),this.addCustomRRWebEvent(ue.GET_SR_PROPS,{shouldRecord:i,eventProperties:o},this.eventCount===10),this.eventCount===10&&(this.eventCount=0),this.eventCount++,o},t.prototype.sendEvents=function(e){var r,n=e||((r=this.identifiers)===null||r===void 0?void 0:r.sessionId),i=this.getDeviceId();this.eventsManager&&n&&i&&this.eventsManager.sendCurrentSequenceEvents({sessionId:n,deviceId:i})},t.prototype.initialize=function(e){var r;return e===void 0&&(e=!1),P(this,void 0,void 0,function(){var n;return C(this,function(i){return!((r=this.identifiers)===null||r===void 0)&&r.sessionId?(n=this.getDeviceId(),n?(this.eventsManager&&e&&this.eventsManager.sendStoredEvents({deviceId:n}),[2,this.recordEvents()]):(this.loggerProvider.log("Session is not being recorded due to lack of device id."),[2,Promise.resolve()])):(this.loggerProvider.log("Session is not being recorded due to lack of session id."),[2,Promise.resolve()])})})},t.prototype.shouldOptOut=function(){var e,r,n;if(!((e=this.config)===null||e===void 0)&&e.instanceName){var i=Bn(this.config.instanceName).identityStore;n=i.getIdentity().optOut}return n!==void 0?n:(r=this.config)===null||r===void 0?void 0:r.optOut},t.prototype.getShouldRecord=function(){if(!this.identifiers||!this.config||!this.identifiers.sessionId)return this.loggerProvider.warn("Session is not being recorded due to lack of config, please call sessionReplay.init."),!1;if(!this.config.captureEnabled)return this.loggerProvider.log("Session ".concat(this.identifiers.sessionId," not being captured due to capture being disabled for project or because the remote config could not be fetched.")),!1;if(this.shouldOptOut())return this.loggerProvider.log("Opting session ".concat(this.identifiers.sessionId," out of recording due to optOut config.")),!1;var e=!1,r="",n=!1;if(this.config.targetingConfig)this.sessionTargetingMatch?(r="Capturing replays for session ".concat(this.identifiers.sessionId," due to matching targeting conditions."),this.loggerProvider.log(r),e=!0,n=!0):(r="Not capturing replays for session ".concat(this.identifiers.sessionId," due to not matching targeting conditions."),this.loggerProvider.log(r),e=!1,n=!1);else{var i=qn(this.identifiers.sessionId,this.config.sampleRate);i?(e=!0,n=!0):(r="Opting session ".concat(this.identifiers.sessionId," out of recording due to sample rate."),this.loggerProvider.log(r),e=!1,n=!1)}return this.lastShouldRecordDecision!==e&&this.config.targetingConfig&&(this.addCustomRRWebEvent(ue.TARGETING_DECISION,{message:r,sessionId:this.identifiers.sessionId,matched:n,targetingParams:this.lastTargetingParams}),this.lastShouldRecordDecision=e),e},t.prototype.getBlockSelectors=function(){var e,r,n,i=(n=(r=(e=this.config)===null||e===void 0?void 0:e.privacyConfig)===null||r===void 0?void 0:r.blockSelector)!==null&&n!==void 0?n:[];if(i.length!==0)return i},t.prototype.getMaskTextSelectors=function(){var e,r,n,i;if(((r=(e=this.config)===null||e===void 0?void 0:e.privacyConfig)===null||r===void 0?void 0:r.defaultMaskLevel)==="conservative")return"*";var o=(i=(n=this.config)===null||n===void 0?void 0:n.privacyConfig)===null||i===void 0?void 0:i.maskSelector;if(o)return o},t.prototype.getRecordingPlugins=function(e){var r,n,i,o,s,a;return P(this,void 0,void 0,function(){var l,u,c,f;return C(this,function(d){switch(d.label){case 0:l=[];try{u=Br({ugcFilterRules:((n=(r=this.config)===null||r===void 0?void 0:r.interactionConfig)===null||n===void 0?void 0:n.ugcFilterRules)||[],enablePolling:((i=this.config)===null||i===void 0?void 0:i.enableUrlChangePolling)||!1,pollingInterval:(o=this.config)===null||o===void 0?void 0:o.urlChangePollingInterval,captureDocumentTitle:(s=this.config)===null||s===void 0?void 0:s.captureDocumentTitle}),l.push(u)}catch(v){this.loggerProvider.warn("Failed to create URL tracking plugin:",v)}if(!(!((a=e?.console)===null||a===void 0)&&a.enabled))return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Pe(()=>import("./rrweb-plugin-console-record.js"),[],import.meta.url)];case 2:return c=d.sent().getRecordConsolePlugin,l.push(c({level:e.console.levels})),[3,4];case 3:return f=d.sent(),this.loggerProvider.warn("Failed to load console plugin:",f),[3,4];case 4:return[2,l.length>0?l:void 0]}})})},t.prototype.getRecordFunction=function(){return P(this,void 0,void 0,function(){var e,r;return C(this,function(n){switch(n.label){case 0:if(this.recordFunction)return[2,this.recordFunction];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,Pe(()=>import("./rrweb-record.js"),[],import.meta.url)];case 2:return e=n.sent().record,this.recordFunction=e,[2,e];case 3:return r=n.sent(),this.loggerProvider.warn("Failed to load rrweb-record module:",r),[2,null];case 4:return[2]}})})},t.prototype.recordEvents=function(e){var r,n,i,o,s;return e===void 0&&(e=!0),P(this,void 0,void 0,function(){var a,l,u,c,f,d,v,m,h,b,w,y,E,I=this;return C(this,function(R){switch(R.label){case 0:return a=this.config,l=this.getShouldRecord(),u=(r=this.identifiers)===null||r===void 0?void 0:r.sessionId,!l||!u||!a?[2]:(this.stopRecordingEvents(),[4,this.getRecordFunction()]);case 1:return c=R.sent(),c?[4,this.initializeNetworkObservers()]:[2];case 2:R.sent(),(n=this.networkObservers)===null||n===void 0||n.start(function(S){I.addCustomRRWebEvent(ue.FETCH_REQUEST,S)}),f=a.privacyConfig,d=a.interactionConfig,v=a.loggingConfig,m=d?.enabled?{mouseInteraction:this.eventsManager&&qo(this.loggerProvider,{eventsManager:this.eventsManager,sessionId:u,deviceIdFn:this.getDeviceId.bind(this),mirror:c.mirror,ugcFilterRules:(i=d.ugcFilterRules)!==null&&i!==void 0?i:[]}),scroll:this.scrollHook}:{},h=d?.enabled&&d.ugcFilterRules?d.ugcFilterRules:[],this.loggerProvider.log("Session Replay capture beginning for ".concat(u,".")),R.label=3;case 3:return R.trys.push([3,5,,6]),b=this,w=c,E={emit:function(S){if(I.shouldOptOut()){I.loggerProvider.log("Opting session ".concat(u," out of recording due to optOut config.")),I.stopRecordingEvents(),I.sendEvents();return}S.type===br.Meta&&(S.data.href=Ye(S.data.href,h)),I.eventCompressor&&I.eventCompressor.enqueueEvent(S,u)},inlineStylesheet:a.shouldInlineStylesheet,hooks:m,maskAllInputs:!0,maskTextClass:gr,blockClass:jn,blockSelector:this.getBlockSelectors(),applyBackgroundColorToBlockedElements:a.applyBackgroundColorToBlockedElements,maskInputFn:Bt("input",f),maskTextFn:Bt("text",f),maskTextSelector:this.getMaskTextSelectors(),recordCanvas:!1,slimDOMOptions:{script:(o=a.omitElementTags)===null||o===void 0?void 0:o.script,comment:(s=a.omitElementTags)===null||s===void 0?void 0:s.comment},errorHandler:function(S){var p=S;if(p.message.includes("insertRule")&&p.message.includes("CSSStyleSheet")||p._external_)throw p;return I.loggerProvider.warn("Error while capturing replay: ",p.toString()),!0}},[4,this.getRecordingPlugins(v)];case 4:return b.recordCancelCallback=w.apply(void 0,[(E.plugins=R.sent(),E)]),this.addCustomRRWebEvent(ue.DEBUG_INFO),e&&this.addCustomRRWebEvent(ue.METADATA,this.metadata),[3,6];case 5:return y=R.sent(),this.loggerProvider.warn("Failed to initialize session replay:",y),[3,6];case 6:return[2]}})})},t.prototype.getDeviceId=function(){var e;return(e=this.identifiers)===null||e===void 0?void 0:e.deviceId},t.prototype.getSessionId=function(){var e;return(e=this.identifiers)===null||e===void 0?void 0:e.sessionId},t.prototype.flush=function(e){var r;return e===void 0&&(e=!1),P(this,void 0,void 0,function(){return C(this,function(n){return[2,(r=this.eventsManager)===null||r===void 0?void 0:r.flush(e)]})})},t.prototype.shutdown=function(){this.teardownEventListeners(!0),this.stopRecordingEvents(),this.sendEvents()},t.prototype.mapSDKType=function(e){return e==="plugin"?"@amplitude/plugin-session-replay-browser":e==="segment"?"@amplitude/segment-session-replay-plugin":null},t.prototype.setMetadata=function(e,r,n,i,o,s,a){var l=e?.toString()?ut(e.toString()):void 0;this.metadata={joinedConfig:r,localConfig:n,remoteConfig:i,sessionId:e,hashValue:l,sampleRate:r.sampleRate,replaySDKType:this.mapSDKType(a),replaySDKVersion:o,standaloneSDKType:"@amplitude/session-replay-browser",standaloneSDKVersion:s}},t.prototype.initializeNetworkObservers=function(){var e,r,n;return P(this,void 0,void 0,function(){var i,o;return C(this,function(s){switch(s.label){case 0:if(!(!((n=(r=(e=this.config)===null||e===void 0?void 0:e.loggingConfig)===null||r===void 0?void 0:r.network)===null||n===void 0)&&n.enabled&&!this.networkObservers))return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,Pe(()=>import("./observers.js"),__vite__mapDeps([16,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url)];case 2:return i=s.sent().NetworkObservers,this.networkObservers=new i,[3,4];case 3:return o=s.sent(),this.loggerProvider.warn("Failed to import or instantiate NetworkObservers:",o),[3,4];case 4:return[2]}})})},t}(),ge=function(t){return function(){var e=t.config,r=e||wr(),n=r.loggerProvider,i=r.logLevel;return{logger:n,logLevel:i}}},jo=function(){var t=new $o;return{init:he(t.init.bind(t),"init",ge(t)),evaluateTargetingAndCapture:he(t.evaluateTargetingAndCapture.bind(t),"evaluateTargetingAndRecord",ge(t)),setSessionId:he(t.setSessionId.bind(t),"setSessionId",ge(t)),getSessionId:he(t.getSessionId.bind(t),"getSessionId",ge(t)),getSessionReplayProperties:he(t.getSessionReplayProperties.bind(t),"getSessionReplayProperties",ge(t)),flush:he(t.flush.bind(t),"flush",ge(t)),shutdown:he(t.shutdown.bind(t),"shutdown",ge(t))}};const Fr=jo();var Yo=Fr.init,Ho=Fr.getSessionReplayProperties;const ar="[Amplitude] Session Replay ID",Qo=()=>{const t=window.ALLBIRDS.settings.amplitude;if(window.ALLBIRDS.settings.amplitude.INITIALIZED!==!0){if(t.sessionReplayEnabled===!1||t.apiKey===void 0){Ke("[Allbirds pixel] - Amplitude - Session Replay not enabled",{amplitudeApiKey:t.apiKey,sessionReplayEnabled:t.sessionReplayEnabled},new Error("Session Replay not enabled"));return}return new Promise(e=>{bt(async()=>{const r=Qr();window.ALLBIRDS.OneTrust.hasPerformanceConsent()&&await Yo(t.apiKey,{deviceId:r.anonymousId,optOut:!1,sampleRate:t.sessionReplaySampleRate,sessionId:window.rudderanalytics.getSessionId()}).promise;const i=Ho();setTimeout(()=>{const s=i?.[ar];if(!s){Ke("[Allbirds pixel] - Amplitude - [Amplitude] Session Replay ID - not found ",{sessionId:s},new Error("Session Replay ID not found"));return}const a=lr();ur({additionalTraits:{fbclid:a.fbclid,gclid:a.gclid,msclkid:a.msclkid,session_replay_session_id:s},email:null}),Xr(s),window.ALLBIRDS.settings.amplitude.INITIALIZED=!0,window.TrackJS&&s&&window.TrackJS.addMetadata(ar,s),e()},500)},It.AMPLITUDE_INIT_SESSION_REPLAY)})}},Xo=window.ALLBIRDS.environment.isUsStore||window.ALLBIRDS.environment.isUkStore;Xo&&Qo();class Zo{constructor(){if(!on()){z("[Allbirds pixel] - Dynamic Yield - Disabled in theme settings");return}this.initializeClientSideCampaignTracking(),this.initializeOnDOMReady()}detectTemplateType(){const e=document.querySelector("main");if(!e)return Ke("[Allbirds pixel] - Dynamic Yield - No main element found"),"";const n=Array.from(e.classList).find(i=>i.startsWith("template-"));return n?n.replace("template-",""):(Ke("[Allbirds pixel] - Dynamic Yield - No template class found"),"")}initializeCampaigns(){try{const{initializeCampaigns:e}=rn(),r=this.detectTemplateType();if(!r){be("[Allbirds pixel] - Dynamic Yield - Could not detect template type");return}const n=this.mapTemplateType(r);z("[Allbirds pixel] - Dynamic Yield - Initializing campaigns",{templateType:n});const i=[],o=Jr[n];o&&i.push(o);const s=en[n];s?.length>0&&i.push(...s);const a=i.filter(l=>l);a.length>0?e(a):z("[Allbirds pixel] - Dynamic Yield - No campaigns for template",{templateType:n})}catch(e){be("[Allbirds pixel] - Dynamic Yield - Error initializing",e)}}initializeClientSideCampaignTracking(){window.ALLBIRDS=window.ALLBIRDS||{},window.ALLBIRDS.DynamicYield={triggerExperimentViewed:nn},z("[Allbirds pixel] - Dynamic Yield - Initialized window.ALLBIRDS.DynamicYield namespace")}initializeOnDOMReady(){document.addEventListener("DOMContentLoaded",()=>{this.waitForDynamicYieldAndInit()})}mapTemplateType(e){return Ne[e.toUpperCase()]||e}waitForDynamicYieldAndInit(){const{isDynamicYieldInitialized:e}=tn(),r=60,n=1e3;let i=1;z("[Allbirds pixel] - Dynamic Yield - Checking initialization");const o=setInterval(()=>{e()?(clearInterval(o),z(`[Allbirds pixel] - Dynamic Yield - Ready after ${i} attempts`),this.initializeCampaigns()):(i>r&&(clearInterval(o),be(`[Allbirds pixel] - Dynamic Yield - Initialization timeout after ${i} attempts`,new Error("Dynamic Yield initialization timeout"))),i++)},n)}}new Zo;export{P as _,C as a,_ as b,$ as g,Ar as o};
//# sourceMappingURL=theme2.js.map
