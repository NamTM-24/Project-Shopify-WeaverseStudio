import{e as U,w as r,i as C}from"./shopify.js";import{c as N,r as u,m as f,o as P,a as F}from"./vue.esm-bundler.js";import{g as G,G as i,s as l}from"./cookies.js";import{G as d,a as S,b as h}from"./geofencing2.js";import{B as b}from"./base-section.js";class A extends b{constructor(){super('[data-section-type="geofencing"]')}init(v){const c=v.container,w=G(i.USER_INFERRED_COUNTRY),p=G(i.USER_SELECTED_SHOP),a=c.getAttribute("data-shop-country");if(!c){U("[Allbirds section] - Geofencing - init - Container not found",{},new Error("Container not found"));return}N({name:"GeofencingSection",setup(){const t=u(!1),n=u(w||null),s=u(p||a||null),O=f(()=>[d[S.US],...Object.values(d).filter(e=>e.id!==S.US).sort((e,o)=>e.name.localeCompare(o.name))]),y=f(()=>!!h[n.value]?.length),R=f(()=>h[n.value]||[]),g=()=>{const e=R.value.at(0);e&&a===n.value&&(s.value=e),n.value!==a&&(t.value=!0)},E=()=>{l(i.USER_SELECTED_SHOP,s.value),t.value=!1},m=e=>{e.key==="Escape"&&t.value&&E()},_=e=>{const o=d[S[e]];if(!o?.url||!o.id){r("[Allbirds section] - Geofencing - handleShopSelection - Shop not found or has no URL",{shopId:e},new Error("Shop not found or has no URL"));return}s.value=o.id,l(i.USER_SELECTED_SHOP,o.id),window.location.href=o.url},k=()=>{window.Shopify?.loadFeatures?.([{name:"consent-tracking-api",version:"0.1"}],function(e){if(e){r("[Allbirds section] - Geofencing - setGeoFencingCookie - Error setting geofencing cookie",{},e);return}if(C("[Allbirds section] - Geofencing - setGeoFencingCookie - Successfully loaded shopify consent-tracking-api",{}),window.Shopify?.customerPrivacy?.getRegion&&typeof window.Shopify.customerPrivacy.getRegion=="function"){const o=window.Shopify.customerPrivacy.getRegion().slice(0,2);o&&!n.value?(l(i.USER_INFERRED_COUNTRY,o),n.value=o,g(),C("[Allbirds section] - Geofencing - setGeoFencingCookie - Successfully set user region cookie",{userRegion:o})):r("[Allbirds section] - Geofencing - setGeoFencingCookie - Error User region not found",{},new Error("User region not found"))}})};return P(()=>{if(new URLSearchParams(window.location.search).get("geofenceoff")==="true"){r("[Allbirds section] - Geofencing - onMounted - Not loaded, geofenceoff parameter is true",{},new Error("Not loaded, geofenceoff parameter is true"));return}p||(k(),n.value&&g()),t.value&&document.addEventListener("keydown",m)}),F(()=>{document.removeEventListener("keydown",m)}),{availableShops:O,handleModalClose:E,handleShopSelection:_,isGeofencingModalOpen:t,isSupportedCountry:y,userCountryIso:n,userSelectedShop:s}}}).mount(c)}}document.addEventListener("DOMContentLoaded",()=>{new A});
//# sourceMappingURL=geofencing.js.map
